<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>mini.snippets documentation – MINI</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../..//assets/logo-mini_180x180.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-0ed1a58f1961f20e100ea025a42ebf64.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-fdc1b2fd0a2d1e1fd2f41bfe1f0ec5c1.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-deb52f76cf1f38a7748e513572c41f9a.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-fc10660e286e6ab0b07026e33ebb6568.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": "tree",
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style> .quarto-title > h1.title { display: none } </style>


<meta property="og:title" content="mini.snippets documentation – MINI">
<meta property="og:description" content="Modular Independent Neovim Improvements">
<meta property="og:image" content="https://nvim-mini.org/assets/logo-mini_social.png">
<meta property="og:site_name" content="MINI">
<meta property="og:image:height" content="630">
<meta property="og:image:width" content="1200">
<meta name="twitter:title" content="mini.snippets documentation – MINI">
<meta name="twitter:description" content="Modular Independent Neovim Improvements">
<meta name="twitter:image" content="https://nvim-mini.org/assets/logo-mini_social.png">
<meta name="twitter:image-height" content="630">
<meta name="twitter:image-width" content="1200">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed quarto-dark"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = true;
    const queryPrefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const darkModeDefault = queryPrefersDark.matches;
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    queryPrefersDark.addEventListener("change", e => {
      if(window.localStorage.getItem("quarto-color-scheme") !== null)
        return;
      const alternate = e.matches
      toggleColorMode(alternate);
      localAlternateSentinel = e.matches ? 'alternate' : 'default'; // this is used alongside local storage!
      toggleGiscusIfUsed(alternate, darkModeDefault);
    });
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">MINI</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../mini.nvim/index.html"> 
<span class="menu-text">mini.nvim</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../MiniMax/index.html"> 
<span class="menu-text">MiniMax</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/nvim-mini"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../blog/index.xml"> <i class="bi bi-rss-fill" role="img" aria-label="RSS">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#module" id="toc-module" class="nav-link active" data-scroll-target="#module">Module</a>
  <ul>
  <li><a href="#module-dependencies" id="toc-module-dependencies" class="nav-link" data-scroll-target="#module-dependencies">Dependencies</a></li>
  <li><a href="#module-setup" id="toc-module-setup" class="nav-link" data-scroll-target="#module-setup">Setup</a></li>
  <li><a href="#module-comparisons" id="toc-module-comparisons" class="nav-link" data-scroll-target="#module-comparisons">Comparisons</a></li>
  <li><a href="#module-highlightgroups" id="toc-module-highlightgroups" class="nav-link" data-scroll-target="#module-highlightgroups">Highlight groups</a></li>
  <li><a href="#module-disabling" id="toc-module-disabling" class="nav-link" data-scroll-target="#module-disabling">Disabling</a></li>
  </ul></li>
  <li><a href="#minisnippets-glossary" id="toc-minisnippets-glossary" class="nav-link" data-scroll-target="#minisnippets-glossary">Glossary</a>
  <ul>
  <li><a href="#minisnippets-glossary-position" id="toc-minisnippets-glossary-position" class="nav-link" data-scroll-target="#minisnippets-glossary-position">POSITION</a></li>
  <li><a href="#minisnippets-glossary-region" id="toc-minisnippets-glossary-region" class="nav-link" data-scroll-target="#minisnippets-glossary-region">REGION</a></li>
  <li><a href="#minisnippets-glossary-snippet" id="toc-minisnippets-glossary-snippet" class="nav-link" data-scroll-target="#minisnippets-glossary-snippet">SNIPPET</a></li>
  <li><a href="#minisnippets-glossary-snippetsession" id="toc-minisnippets-glossary-snippetsession" class="nav-link" data-scroll-target="#minisnippets-glossary-snippetsession">SNIPPET SESSION</a></li>
  <li><a href="#minisnippets-glossary-matchedsnippet" id="toc-minisnippets-glossary-matchedsnippet" class="nav-link" data-scroll-target="#minisnippets-glossary-matchedsnippet">MATCHED SNIPPET</a></li>
  <li><a href="#minisnippets-glossary-snippetnode" id="toc-minisnippets-glossary-snippetnode" class="nav-link" data-scroll-target="#minisnippets-glossary-snippetnode">SNIPPET NODE</a></li>
  <li><a href="#minisnippets-glossary-tabstop" id="toc-minisnippets-glossary-tabstop" class="nav-link" data-scroll-target="#minisnippets-glossary-tabstop">TABSTOP</a></li>
  <li><a href="#minisnippets-glossary-linkedtabstops" id="toc-minisnippets-glossary-linkedtabstops" class="nav-link" data-scroll-target="#minisnippets-glossary-linkedtabstops">LINKED TABSTOPS</a></li>
  <li><a href="#minisnippets-glossary-referencenode" id="toc-minisnippets-glossary-referencenode" class="nav-link" data-scroll-target="#minisnippets-glossary-referencenode">REFERENCE NODE</a></li>
  <li><a href="#minisnippets-glossary-expand" id="toc-minisnippets-glossary-expand" class="nav-link" data-scroll-target="#minisnippets-glossary-expand">EXPAND</a></li>
  </ul></li>
  <li><a href="#minisnippets-overview" id="toc-minisnippets-overview" class="nav-link" data-scroll-target="#minisnippets-overview">Overview</a>
  <ul>
  <li><a href="#minisnippets-overview-snippetstructure" id="toc-minisnippets-overview-snippetstructure" class="nav-link" data-scroll-target="#minisnippets-overview-snippetstructure">Snippet structure</a></li>
  <li><a href="#minisnippets-overview-syntax" id="toc-minisnippets-overview-syntax" class="nav-link" data-scroll-target="#minisnippets-overview-syntax">Syntax</a></li>
  <li><a href="#minisnippets-overview-expand" id="toc-minisnippets-overview-expand" class="nav-link" data-scroll-target="#minisnippets-overview-expand">Expand</a></li>
  <li><a href="#minisnippets-overview-management" id="toc-minisnippets-overview-management" class="nav-link" data-scroll-target="#minisnippets-overview-management">Management</a>
  <ul>
  <li><a href="#minisnippets-overview-management-filespecification" id="toc-minisnippets-overview-management-filespecification" class="nav-link" data-scroll-target="#minisnippets-overview-management-filespecification">File specification</a></li>
  <li><a href="#minisnippets-overview-management-generaladvice" id="toc-minisnippets-overview-management-generaladvice" class="nav-link" data-scroll-target="#minisnippets-overview-management-generaladvice">General advice</a></li>
  </ul></li>
  <li><a href="#minisnippets-overview-demo" id="toc-minisnippets-overview-demo" class="nav-link" data-scroll-target="#minisnippets-overview-demo">Demo</a></li>
  </ul></li>
  <li><a href="#minisnippets-examples" id="toc-minisnippets-examples" class="nav-link" data-scroll-target="#minisnippets-examples">Examples</a>
  <ul>
  <li><a href="#minisnippets-examples-basicsnippetmanagementconfig" id="toc-minisnippets-examples-basicsnippetmanagementconfig" class="nav-link" data-scroll-target="#minisnippets-examples-basicsnippetmanagementconfig">Basic snippet management config</a></li>
  <li><a href="#minisnippets-examples-selectfromallavailablesnippetsincurrentcontext" id="toc-minisnippets-examples-selectfromallavailablesnippetsincurrentcontext" class="nav-link" data-scroll-target="#minisnippets-examples-selectfromallavailablesnippetsincurrentcontext">Select from all available snippets in current context</a></li>
  <li><a href="#minisnippets-examples-supertab-likespanclasshelp-syntax-keystabspanspanclasshelp-syntax-keyss-tabspanmappings" id="toc-minisnippets-examples-supertab-likespanclasshelp-syntax-keystabspanspanclasshelp-syntax-keyss-tabspanmappings" class="nav-link" data-scroll-target="#minisnippets-examples-supertab-likespanclasshelp-syntax-keystabspanspanclasshelp-syntax-keyss-tabspanmappings">“Supertab”-like <span class="help-syntax-keys">&lt;Tab&gt;</span> / <span class="help-syntax-keys">&lt;S-Tab&gt;</span> mappings</a></li>
  <li><a href="#minisnippets-examples-stopsessionimmediatelyafterjumpingtofinaltabstop" id="toc-minisnippets-examples-stopsessionimmediatelyafterjumpingtofinaltabstop" class="nav-link" data-scroll-target="#minisnippets-examples-stopsessionimmediatelyafterjumpingtofinaltabstop">Stop session immediately after jumping to final tabstop</a></li>
  <li><a href="#minisnippets-examples-stopallsessionsonnormalmodeexit" id="toc-minisnippets-examples-stopallsessionsonnormalmodeexit" class="nav-link" data-scroll-target="#minisnippets-examples-stopallsessionsonnormalmodeexit">Stop all sessions on Normal mode exit</a></li>
  <li><a href="#minisnippets-examples-customizevariableevaluation" id="toc-minisnippets-examples-customizevariableevaluation" class="nav-link" data-scroll-target="#minisnippets-examples-customizevariableevaluation">Customize variable evaluation</a></li>
  <li><a href="#minisnippets-examples-usingneovimsbuilt-instoinsertsnippet" id="toc-minisnippets-examples-usingneovimsbuilt-instoinsertsnippet" class="nav-link" data-scroll-target="#minisnippets-examples-usingneovimsbuilt-instoinsertsnippet">Using Neovim’s built-ins to insert snippet</a></li>
  <li><a href="#minisnippets-examples-usingmini.snippetsinotherplugins" id="toc-minisnippets-examples-usingmini.snippetsinotherplugins" class="nav-link" data-scroll-target="#minisnippets-examples-usingmini.snippetsinotherplugins">Using ‘mini.snippets’ in other plugins</a></li>
  </ul></li>
  <li><a href="#minisnippets.setup" id="toc-minisnippets.setup" class="nav-link" data-scroll-target="#minisnippets.setup">setup()</a>
  <ul>
  <li><a href="#minisnippets.setup-parameters" id="toc-minisnippets.setup-parameters" class="nav-link" data-scroll-target="#minisnippets.setup-parameters">Parameters</a></li>
  <li><a href="#minisnippets.setup-usage" id="toc-minisnippets.setup-usage" class="nav-link" data-scroll-target="#minisnippets.setup-usage">Usage</a></li>
  </ul></li>
  <li><a href="#minisnippets.config" id="toc-minisnippets.config" class="nav-link" data-scroll-target="#minisnippets.config">config</a>
  <ul>
  <li><a href="#minisnippets.config-defaults" id="toc-minisnippets.config-defaults" class="nav-link" data-scroll-target="#minisnippets.config-defaults">Defaults</a></li>
  <li><a href="#minisnippets.config-loadedsnippets" id="toc-minisnippets.config-loadedsnippets" class="nav-link" data-scroll-target="#minisnippets.config-loadedsnippets">Loaded snippets</a></li>
  <li><a href="#minisnippets.config-mappings" id="toc-minisnippets.config-mappings" class="nav-link" data-scroll-target="#minisnippets.config-mappings">Mappings</a></li>
  <li><a href="#minisnippets.config-expand" id="toc-minisnippets.config-expand" class="nav-link" data-scroll-target="#minisnippets.config-expand">Expand</a></li>
  </ul></li>
  <li><a href="#minisnippets.expand" id="toc-minisnippets.expand" class="nav-link" data-scroll-target="#minisnippets.expand">expand()</a>
  <ul>
  <li><a href="#minisnippets.expand-parameters" id="toc-minisnippets.expand-parameters" class="nav-link" data-scroll-target="#minisnippets.expand-parameters">Parameters</a></li>
  <li><a href="#minisnippets.expand-return" id="toc-minisnippets.expand-return" class="nav-link" data-scroll-target="#minisnippets.expand-return">Return</a></li>
  <li><a href="#minisnippets.expand-usage" id="toc-minisnippets.expand-usage" class="nav-link" data-scroll-target="#minisnippets.expand-usage">Usage</a></li>
  <li><a href="#minisnippets.expand-seealso" id="toc-minisnippets.expand-seealso" class="nav-link" data-scroll-target="#minisnippets.expand-seealso">See also</a></li>
  </ul></li>
  <li><a href="#minisnippets.gen_loader" id="toc-minisnippets.gen_loader" class="nav-link" data-scroll-target="#minisnippets.gen_loader">gen_loader</a></li>
  <li><a href="#minisnippets.gen_loader.from_lang" id="toc-minisnippets.gen_loader.from_lang" class="nav-link" data-scroll-target="#minisnippets.gen_loader.from_lang">gen_loader.from_lang()</a>
  <ul>
  <li><a href="#minisnippets.gen_loader.from_lang-parameters" id="toc-minisnippets.gen_loader.from_lang-parameters" class="nav-link" data-scroll-target="#minisnippets.gen_loader.from_lang-parameters">Parameters</a></li>
  <li><a href="#minisnippets.gen_loader.from_lang-return" id="toc-minisnippets.gen_loader.from_lang-return" class="nav-link" data-scroll-target="#minisnippets.gen_loader.from_lang-return">Return</a></li>
  <li><a href="#minisnippets.gen_loader.from_lang-usage" id="toc-minisnippets.gen_loader.from_lang-usage" class="nav-link" data-scroll-target="#minisnippets.gen_loader.from_lang-usage">Usage</a></li>
  </ul></li>
  <li><a href="#minisnippets.gen_loader.from_runtime" id="toc-minisnippets.gen_loader.from_runtime" class="nav-link" data-scroll-target="#minisnippets.gen_loader.from_runtime">gen_loader.from_runtime()</a>
  <ul>
  <li><a href="#minisnippets.gen_loader.from_runtime-parameters" id="toc-minisnippets.gen_loader.from_runtime-parameters" class="nav-link" data-scroll-target="#minisnippets.gen_loader.from_runtime-parameters">Parameters</a></li>
  <li><a href="#minisnippets.gen_loader.from_runtime-return" id="toc-minisnippets.gen_loader.from_runtime-return" class="nav-link" data-scroll-target="#minisnippets.gen_loader.from_runtime-return">Return</a></li>
  </ul></li>
  <li><a href="#minisnippets.gen_loader.from_file" id="toc-minisnippets.gen_loader.from_file" class="nav-link" data-scroll-target="#minisnippets.gen_loader.from_file">gen_loader.from_file()</a>
  <ul>
  <li><a href="#minisnippets.gen_loader.from_file-parameters" id="toc-minisnippets.gen_loader.from_file-parameters" class="nav-link" data-scroll-target="#minisnippets.gen_loader.from_file-parameters">Parameters</a></li>
  <li><a href="#minisnippets.gen_loader.from_file-return" id="toc-minisnippets.gen_loader.from_file-return" class="nav-link" data-scroll-target="#minisnippets.gen_loader.from_file-return">Return</a></li>
  </ul></li>
  <li><a href="#minisnippets.read_file" id="toc-minisnippets.read_file" class="nav-link" data-scroll-target="#minisnippets.read_file">read_file()</a>
  <ul>
  <li><a href="#minisnippets.read_file-parameters" id="toc-minisnippets.read_file-parameters" class="nav-link" data-scroll-target="#minisnippets.read_file-parameters">Parameters</a></li>
  <li><a href="#minisnippets.read_file-return" id="toc-minisnippets.read_file-return" class="nav-link" data-scroll-target="#minisnippets.read_file-return">Return</a></li>
  </ul></li>
  <li><a href="#minisnippets.default_prepare" id="toc-minisnippets.default_prepare" class="nav-link" data-scroll-target="#minisnippets.default_prepare">default_prepare()</a>
  <ul>
  <li><a href="#minisnippets.default_prepare-parameters" id="toc-minisnippets.default_prepare-parameters" class="nav-link" data-scroll-target="#minisnippets.default_prepare-parameters">Parameters</a></li>
  <li><a href="#minisnippets.default_prepare-return" id="toc-minisnippets.default_prepare-return" class="nav-link" data-scroll-target="#minisnippets.default_prepare-return">Return</a></li>
  </ul></li>
  <li><a href="#minisnippets.default_match" id="toc-minisnippets.default_match" class="nav-link" data-scroll-target="#minisnippets.default_match">default_match()</a>
  <ul>
  <li><a href="#minisnippets.default_match-parameters" id="toc-minisnippets.default_match-parameters" class="nav-link" data-scroll-target="#minisnippets.default_match-parameters">Parameters</a></li>
  <li><a href="#minisnippets.default_match-return" id="toc-minisnippets.default_match-return" class="nav-link" data-scroll-target="#minisnippets.default_match-return">Return</a></li>
  <li><a href="#minisnippets.default_match-usage" id="toc-minisnippets.default_match-usage" class="nav-link" data-scroll-target="#minisnippets.default_match-usage">Usage</a></li>
  </ul></li>
  <li><a href="#minisnippets.default_select" id="toc-minisnippets.default_select" class="nav-link" data-scroll-target="#minisnippets.default_select">default_select()</a>
  <ul>
  <li><a href="#minisnippets.default_select-parameters" id="toc-minisnippets.default_select-parameters" class="nav-link" data-scroll-target="#minisnippets.default_select-parameters">Parameters</a></li>
  </ul></li>
  <li><a href="#minisnippets.default_insert" id="toc-minisnippets.default_insert" class="nav-link" data-scroll-target="#minisnippets.default_insert">default_insert()</a>
  <ul>
  <li><a href="#minisnippets.default_insert-sessionlifecycle" id="toc-minisnippets.default_insert-sessionlifecycle" class="nav-link" data-scroll-target="#minisnippets.default_insert-sessionlifecycle">Session life cycle</a></li>
  <li><a href="#minisnippets.default_insert-events" id="toc-minisnippets.default_insert-events" class="nav-link" data-scroll-target="#minisnippets.default_insert-events">Events</a></li>
  <li><a href="#minisnippets.default_insert-parameters" id="toc-minisnippets.default_insert-parameters" class="nav-link" data-scroll-target="#minisnippets.default_insert-parameters">Parameters</a></li>
  </ul></li>
  <li><a href="#minisnippets.session" id="toc-minisnippets.session" class="nav-link" data-scroll-target="#minisnippets.session">session</a></li>
  <li><a href="#minisnippets.session.get" id="toc-minisnippets.session.get" class="nav-link" data-scroll-target="#minisnippets.session.get">session.get()</a>
  <ul>
  <li><a href="#minisnippets.session.get-parameters" id="toc-minisnippets.session.get-parameters" class="nav-link" data-scroll-target="#minisnippets.session.get-parameters">Parameters</a></li>
  <li><a href="#minisnippets.session.get-return" id="toc-minisnippets.session.get-return" class="nav-link" data-scroll-target="#minisnippets.session.get-return">Return</a></li>
  </ul></li>
  <li><a href="#minisnippets.session.jump" id="toc-minisnippets.session.jump" class="nav-link" data-scroll-target="#minisnippets.session.jump">session.jump()</a>
  <ul>
  <li><a href="#minisnippets.session.jump-parameters" id="toc-minisnippets.session.jump-parameters" class="nav-link" data-scroll-target="#minisnippets.session.jump-parameters">Parameters</a></li>
  </ul></li>
  <li><a href="#minisnippets.session.stop" id="toc-minisnippets.session.stop" class="nav-link" data-scroll-target="#minisnippets.session.stop">session.stop()</a></li>
  <li><a href="#minisnippets.parse" id="toc-minisnippets.parse" class="nav-link" data-scroll-target="#minisnippets.parse">parse()</a>
  <ul>
  <li><a href="#minisnippets.parse-parameters" id="toc-minisnippets.parse-parameters" class="nav-link" data-scroll-target="#minisnippets.parse-parameters">Parameters</a></li>
  <li><a href="#minisnippets.parse-return" id="toc-minisnippets.parse-return" class="nav-link" data-scroll-target="#minisnippets.parse-return">Return</a></li>
  </ul></li>
  <li><a href="#minisnippets.start_lsp_server" id="toc-minisnippets.start_lsp_server" class="nav-link" data-scroll-target="#minisnippets.start_lsp_server">start_lsp_server()</a>
  <ul>
  <li><a href="#minisnippets.start_lsp_server-parameters" id="toc-minisnippets.start_lsp_server-parameters" class="nav-link" data-scroll-target="#minisnippets.start_lsp_server-parameters">Parameters</a></li>
  <li><a href="#minisnippets.start_lsp_server-return" id="toc-minisnippets.start_lsp_server-return" class="nav-link" data-scroll-target="#minisnippets.start_lsp_server-return">Return</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">mini.snippets documentation</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><em>Generated from the <code>main</code> branch of ‘mini.nvim’</em></p>
<p><a name="mini.snippets" href="../../mini.nvim/doc/mini-snippets.html#mini.snippets"><b>mini.snippets</b></a> Manage and expand snippets</p>
<p>MIT License Copyright (c) 2024 Evgeni Chasnovski</p>
<hr>
<section id="module" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="module">Module</h3>
<p>Snippet is a template for a frequently used text. Typical workflow is to type snippet’s (configurable) prefix and expand it into a snippet session.</p>
<p>The template usually contains both pre-defined text and places (called “tabstops”) for user to interactively change/add text during snippet session.</p>
<p>This module supports (only) snippet syntax defined in LSP specification (with small deviations). See <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-syntax-specification">MiniSnippets-syntax-specification</a>.</p>
<p>Features:</p>
<ul>
<li><p>Manage snippet collection by adding it explicitly or with a flexible set of performant built-in loaders. See <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.gen_loader">MiniSnippets.gen_loader</a>.</p></li>
<li><p>Configured snippets are efficiently resolved before every expand based on current local context. This, for example, allows using different snippets in different local tree-sitter languages (like in markdown code blocks). See <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.default_prepare">MiniSnippets.default_prepare()</a>.</p></li>
<li><p>Match which snippet to insert based on the currently typed text. Supports both exact and fuzzy matching. See <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.default_match">MiniSnippets.default_match()</a>.</p></li>
<li><p>Select from several matched snippets via <code>vim.ui.select()</code>. See <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.default_select">MiniSnippets.default_select()</a>.</p></li>
<li><p>Start specialized in-process LSP server to show loaded snippets inside (auto)completion engines (like <a href="../../mini.nvim/doc/mini-completion.html#mini.completion">mini.completion</a>). See <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.start_lsp_server">MiniSnippets.start_lsp_server()</a>.</p></li>
<li><p>Insert, jump, and edit during snippet session in a configurable manner:</p>
<ul>
<li><p>Configurable mappings for jumping and stopping.</p></li>
<li><p>Jumping wraps around the tabstops for easier navigation.</p></li>
<li><p>Easy to reason rules for when session automatically stops.</p></li>
<li><p>Text synchronization of linked tabstops preserving relative indent.</p></li>
<li><p>Dynamic tabstop state visualization (current/visited/unvisited, etc.)</p></li>
<li><p>Inline visualization of empty tabstops (requires Neovim&gt;=0.10).</p></li>
<li><p>Works inside comments by preserving comment leader on new lines.</p></li>
<li><p>Supports nested sessions (expand snippet while there is an active one). See <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.default_insert">MiniSnippets.default_insert()</a>.</p></li>
</ul></li>
<li><p>Exported function to parse snippet body into easy-to-reason data structure. See <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.parse">MiniSnippets.parse()</a>.</p></li>
</ul>
<p>Notes:</p>
<ul>
<li><p>It does not set up any snippet collection by default. Explicitly populate <code>config.snippets</code> to have snippets to match from.</p></li>
<li><p>It does not come with a built-in snippet collection. It is expected from users to add their own snippets, manually or with dedicated plugin(s).</p></li>
<li><p>It does not support variable/tabstop transformations in default snippet session. This requires ECMAScript Regular Expression parser which can not be implemented concisely.</p></li>
</ul>
<p>Sources with more details:</p>
<ul>
<li><p><a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-glossary">MiniSnippets-glossary</a></p></li>
<li><p><a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-overview">MiniSnippets-overview</a></p></li>
<li><p><a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-examples">MiniSnippets-examples</a></p></li>
<li><p><a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-in-other-plugins">MiniSnippets-in-other-plugins</a> (for plugin authors)</p></li>
</ul>
<section id="module-dependencies" class="level4">
<h4 class="anchored" data-anchor-id="module-dependencies">Dependencies</h4>
<p>This module doesn’t come with snippet collection. Either create it manually or install a dedicated plugin. For example, <a href="https://github.com/rafamadriz/friendly-snippets">rafamadriz/friendly-snippets</a>.</p>
</section>
<section id="module-setup" class="level4">
<h4 class="anchored" data-anchor-id="module-setup">Setup</h4>
<p>This module needs a setup with <code>require('mini.snippets').setup({})</code> (replace <code>{}</code> with your <code>config</code> table). It will create global Lua table <code>MiniSnippets</code> which you can use for scripting or manually (with <code>:lua MiniSnippets.*</code>).</p>
<p>See <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.config">MiniSnippets.config</a> for <code>config</code> structure and default values.</p>
<p>You can override runtime config settings locally to buffer inside <code>vim.b.minisnippets_config</code> which should have same structure as <code>Minisnippets.config</code>. See <a href="../../mini.nvim/doc/mini-nvim.html#mini.nvim-buffer-local-config">mini.nvim-buffer-local-config</a> for more details.</p>
</section>
<section id="module-comparisons" class="level4">
<h4 class="anchored" data-anchor-id="module-comparisons">Comparisons</h4>
<ul>
<li><p><a href="https://github.com/L3MON4D3/LuaSnip">L3MON4D3/LuaSnip</a>:</p>
<ul>
<li><p>Both contain functionality to load snippets from file system. This module provides several common loader generators while ‘LuaSnip’ contains a more elaborate loading setup. Also both require explicit opt-in for which snippets to load.</p></li>
<li><p>Both support LSP snippet format. ‘LuaSnip’ also provides own more elaborate snippet format which is out of scope for this module.</p></li>
<li><p>‘LuaSnip’ can autoexpand snippets, while this module always requires an explicit user action to expand (by design).</p></li>
<li><p>Both contain snippet expand functionality which differs in some aspects:</p>
<ul>
<li><p>‘LuaSnip’ has an elaborate dynamic tabstop visualization config. This module provides a handful of dedicated highlight groups.</p></li>
<li><p>This module provides configurable visualization of empty tabstops.</p></li>
<li><p>‘LusSnip’ implements nested sessions by essentially merging them into one. This module treats each nested session separately (to not visually overload) while storing them in stack (first in last out).</p></li>
<li><p>‘LuaSnip’ uses <a href="https://neovim.io/doc/user/helptag.html?tag=Select-mode">Select-mode</a> to power replacing current tabstop, while this module always stays in <a href="https://neovim.io/doc/user/helptag.html?tag=Insert-mode">Insert-mode</a>. This enables easier mapping understanding and more targeted highlighting.</p></li>
<li><p>This module implements jumping which wraps after final tabstop for more flexible navigation (enhanced with by a more flexible autostopping rules), while ‘LuaSnip’ autostops session once jumping reached the final tabstop.</p></li>
</ul></li>
</ul></li>
<li><p>Built-in <a href="https://neovim.io/doc/user/helptag.html?tag=vim.snippet">vim.snippet</a> (on Neovim&gt;=0.10):</p>
<ul>
<li><p>Does not contain functionality to load or match snippets (by design), while this module does.</p></li>
<li><p>Both contain expand functionality based on LSP snippet format. Differences in how snippet sessions are handled are similar to comparison with ‘LuaSnip’.</p></li>
</ul></li>
<li><p><a href="https://github.com/rafamadriz/friendly-snippets">rafamadriz/friendly-snippets</a>:</p>
<ul>
<li>A snippet collection plugin without features to manage or expand them. This module is designed with ‘friendly-snippets’ compatibility in mind.</li>
</ul></li>
<li><p><a href="https://github.com/abeldekat/cmp-mini-snippets">abeldekat/cmp-mini-snippets</a>:</p>
<ul>
<li>A source for <a href="https://github.com/hrsh7th/nvim-cmp">hrsh7th/nvim-cmp</a> that integrates ‘mini.snippets’.</li>
</ul></li>
</ul>
</section>
<section id="module-highlightgroups" class="level4">
<h4 class="anchored" data-anchor-id="module-highlightgroups">Highlight groups</h4>
<ul>
<li><p><code>MiniSnippetsCurrent</code> - current tabstop.</p></li>
<li><p><code>MiniSnippetsCurrentReplace</code> - current tabstop, placeholder is to be replaced.</p></li>
<li><p><code>MiniSnippetsFinal</code> - special <code>$0</code> tabstop.</p></li>
<li><p><code>MiniSnippetsUnvisited</code> - not yet visited tabstop(s).</p></li>
<li><p><code>MiniSnippetsVisited</code> - visited tabstop(s).</p></li>
</ul>
<p>To change any highlight group, set it directly with <a href="https://neovim.io/doc/user/helptag.html?tag=nvim_set_hl()">nvim_set_hl()</a>.</p>
</section>
<section id="module-disabling" class="level4">
<h4 class="anchored" data-anchor-id="module-disabling">Disabling</h4>
<p>To disable core functionality, set <code>vim.g.minisnippets_disable</code> (globally) or <code>vim.b.minisnippets_disable</code> (for a buffer) to <code>true</code>. Considering high number of different scenarios and customization intentions, writing exact rules for disabling module’s functionality is left to user. See <a href="../../mini.nvim/doc/mini-nvim.html#mini.nvim-disabling-recipes">mini.nvim-disabling-recipes</a> for common recipes.</p>
<hr>
</section>
</section>
<section id="minisnippets-glossary" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="minisnippets-glossary">Glossary</h3>
<section id="minisnippets-glossary-position" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-glossary-position">POSITION</h4>
<p>Table representing position in a buffer. Fields:</p>
<ul>
<li><p><span class="help-syntax-keys">&lt;line&gt;</span> <code>(number)</code> - line number (starts at 1).</p></li>
<li><p><span class="help-syntax-keys">&lt;col&gt;</span> <code>(number)</code> - column number (starts at 1).</p></li>
</ul>
</section>
<section id="minisnippets-glossary-region" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-glossary-region">REGION</h4>
<p>Table representing region in a buffer. Fields: <span class="help-syntax-keys">&lt;from&gt;</span> and <span class="help-syntax-keys">&lt;to&gt;</span> for inclusive start/end POSITIONs.</p>
</section>
<section id="minisnippets-glossary-snippet" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-glossary-snippet">SNIPPET</h4>
<p>Data about template to insert. Should contain fields:</p>
<ul>
<li><p><span class="help-syntax-keys">&lt;prefix&gt;</span> - string snippet identifier.</p></li>
<li><p><span class="help-syntax-keys">&lt;body&gt;</span> - string snippet content with appropriate syntax.</p></li>
<li><p><span class="help-syntax-keys">&lt;desc&gt;</span> - string snippet description in human readable form.</p></li>
</ul>
<p>Can also be used to mean snippet body if distinction is clear.</p>
</section>
<section id="minisnippets-glossary-snippetsession" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-glossary-snippetsession">SNIPPET SESSION</h4>
<p>Interactive state for user to adjust inserted snippet.</p>
</section>
<section id="minisnippets-glossary-matchedsnippet" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-glossary-matchedsnippet">MATCHED SNIPPET</h4>
<p>Snippet which contains <span class="help-syntax-keys">&lt;region&gt;</span> field with region that matched it. Usually region needs to be removed.</p>
</section>
<section id="minisnippets-glossary-snippetnode" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-glossary-snippetnode">SNIPPET NODE</h4>
<p>Unit of parsed snippet body. See <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.parse">MiniSnippets.parse()</a>.</p>
</section>
<section id="minisnippets-glossary-tabstop" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-glossary-tabstop">TABSTOP</h4>
<p>Dedicated places in snippet body for users to interactively adjust. Specified in snippet body with <code>$</code> followed by digit(s).</p>
</section>
<section id="minisnippets-glossary-linkedtabstops" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-glossary-linkedtabstops">LINKED TABSTOPS</h4>
<p>Different nodes assigned the same tabstop. Updated in sync.</p>
</section>
<section id="minisnippets-glossary-referencenode" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-glossary-referencenode">REFERENCE NODE</h4>
<p>First (from left to right) node of linked tabstops. Used to determine synced text and cursor placement after jump.</p>
</section>
<section id="minisnippets-glossary-expand" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-glossary-expand">EXPAND</h4>
<p>Action to start snippet session based on currently typed text. Always done in current buffer at cursor. Executed steps:</p>
<ul>
<li><p><code>PREPARE</code> - resolve raw config snippets at context.</p></li>
<li><p><code>MATCH</code> - match resolved snippets at cursor position.</p></li>
<li><p><code>SELECT</code> - possibly choose among matched snippets.</p></li>
<li><p><code>INSERT</code> - insert selected snippet and start snippet session.</p></li>
</ul>
<hr>
</section>
</section>
<section id="minisnippets-overview" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="minisnippets-overview">Overview</h3>
<p>Snippet is a template for a frequently used text. Typical workflow is to type snippet’s (configurable) prefix and expand it into a snippet session: add some pre-defined text and allow user to interactively change/add at certain places.</p>
<p>This overview assumes default config for mappings and expand. See <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.config">MiniSnippets.config</a> and <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-examples">MiniSnippets-examples</a> for more details.</p>
<section id="minisnippets-overview-snippetstructure" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-overview-snippetstructure">Snippet structure</h4>
<p>Snippet consists from three parts:</p>
<ul>
<li><p><code>Prefix</code> - identifier used to match against current text.</p></li>
<li><p><code>Body</code> - actually inserted content with appropriate syntax.</p></li>
<li><p><code>Desc</code> - description in human readable form.</p></li>
</ul>
<p>Example: <code>{ prefix = 'tis', body = 'This is snippet', desc = 'Snip' }</code> Typing <code>tis</code> and pressing “expand” mapping (<span class="help-syntax-keys">&lt;C-j&gt;</span> by default) will remove “tis”, add “This is snippet”, and place cursor at the end in Insert mode.</p>
</section>
<section id="minisnippets-overview-syntax" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-overview-syntax">Syntax</h4>
<p><a name="minisnippets-syntax-specification" href="../../mini.nvim/doc/mini-snippets.html#minisnippets-syntax-specification"><b>MiniSnippets-syntax-specification</b></a></p>
<p>Inserting just text after typing smaller prefix is already powerful enough. For more flexibility, snippet body can be formatted in a special way to provide extra features. This module implements support for syntax defined in LSP specification (with small deviations). See this link for reference: https://microsoft.github.io/language-server-protocol/specifications/lsp/3.18/specification/#snippet_syntax</p>
<p>A quick overview of basic syntax features:</p>
<ul>
<li><p>Tabstops are snippet parts meant for interactive editing at their location. They are denoted as <code>$1</code>, <code>$2</code>, etc. Navigating between them is called “jumping” and is done in numerical order of tabstop identifiers by pressing special keys: <span class="help-syntax-keys">&lt;C-l&gt;</span> and <span class="help-syntax-keys">&lt;C-h&gt;</span> to jump to next and previous tabstop respectively. Special tabstop <code>$0</code> is called “final tabstop”: it is used to decide when snippet session is automatically stopped and is visited last during jumping.</p>
<p>Example: <code>T1=$1 T2=$2 T0=$0</code> is expanded as <code>T1= T2= T0=</code> with three tabstops.</p></li>
<li><p>Tabstop can have placeholder: a text used if tabstop is not yet edited. Text is preserved if no editing is done. It follows this same syntax, which means it can itself contain tabstops with placeholders (i.e.&nbsp;be nested). Tabstop with placeholder is denoted as <code>${1:placeholder}</code> (<code>$1</code> is <code>${1:}</code>).</p>
<p>Example: <code>T1=${1:text} T2=${2:&lt;$1&gt;}</code> is expanded as <code>T1=text T2=&lt;text&gt;</code>; typing <code>x</code> at first placeholder results in <code>T1=x T2=&lt;x&gt;</code>; jumping once and typing <code>y</code> results in <code>T1=x T2=y</code>.</p></li>
<li><p>There can be several tabstops with same identifier. They are linked and updated in sync during text editing. Can also have different placeholders; they are forced to be the same as in the first (from left to right) tabstop.</p>
<p>Example: <code>T1=${1:text} T1=$1</code> is expanded as <code>T1=text T1=text</code>; typing <code>x</code> at first placeholder results in <code>T1=x T1=x</code>.</p></li>
<li><p>Tabstop can also have choices: suggestions about tabstop text. It is denoted as <code>${1|a,b,c|}</code>. First choice is used as placeholder.</p>
<p>Example: <code>T1=${1|left,right|}</code> is expanded as <code>T1=left</code>.</p></li>
<li><p>Variables can be used to automatically insert text without user interaction. As tabstops, each one can have a placeholder which is used if variable is not defined. There is a special set of variables describing editor state.</p>
<p>Example: <code>V1=$TM_FILENAME V2=${NOTDEFINED:placeholder}</code> is expanded as <code>V1=current-file-basename V2=placeholder</code>.</p></li>
</ul>
<p>What’s different from LSP specification:</p>
<ul>
<li><p>Special set of variables is wider and is taken from VSCode specification: https://code.visualstudio.com/docs/editor/userdefinedsnippets#_variables Exceptions are <code>BLOCK_COMMENT_START</code> and <code>BLOCK_COMMENT_END</code> as Neovim doesn’t provide this information.</p></li>
<li><p>Variable <code>TM_SELECTED_TEXT</code> is resolved as contents of <a href="https://neovim.io/doc/user/helptag.html?tag=quote_quote">quote_quote</a> register. It assumes that text is put there prior to expanding. For example, visually select, press <a href="https://neovim.io/doc/user/helptag.html?tag=c">c</a>, type prefix, and expand. See <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-examples">MiniSnippets-examples</a> for how to adjust this.</p></li>
<li><p>Environment variables are recognized and supported: <code>V1=$VIMRUNTIME</code> will use an actual value of <a href="https://neovim.io/doc/user/helptag.html?tag=$VIMRUNTIME">$VIMRUNTIME</a>.</p></li>
<li><p>Variable transformations are not supported during snippet session. It would require interacting with ECMAScript-like regular expressions for which there is no easy way in Neovim. It may change in the future. Transformations are recognized during parsing, though, with some exceptions:</p>
<ul>
<li>The <code>}</code> inside <code>if</code> of <code>${1:?if:else}</code> needs escaping (for technical reasons).</li>
</ul></li>
</ul>
<p>There is a <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.parse">MiniSnippets.parse()</a> function for programmatically parsing snippet body into a comprehensible data structure.</p>
</section>
<section id="minisnippets-overview-expand" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-overview-expand">Expand</h4>
<p>Using snippets is done via what is called “expanding”. It goes like this:</p>
<ul>
<li><p>Type snippet prefix or its recognizable part.</p></li>
<li><p>Press <span class="help-syntax-keys">&lt;C-j&gt;</span> to expand. It will perform the following steps:</p>
<ul>
<li><p>Prepare available snippets in current context (buffer + local language). This allows snippet setup to have general function loaders which return different snippets in different contexts.</p></li>
<li><p>Match text to the left of cursor with available prefixes. It first tries to do exact match and falls back to fuzzy matching.</p></li>
<li><p>If there are several matches, use <code>vim.ui.select()</code> to choose one.</p></li>
<li><p>Insert single matching snippet. If snippet contains tabstops, start snippet session.</p></li>
</ul></li>
</ul>
<p>For more details about each step see:</p>
<ul>
<li><p><a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.default_prepare">MiniSnippets.default_prepare()</a></p></li>
<li><p><a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.default_match">MiniSnippets.default_match()</a></p></li>
<li><p><a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.default_select">MiniSnippets.default_select()</a></p></li>
<li><p><a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.default_insert">MiniSnippets.default_insert()</a></p></li>
</ul>
<p>Snippet session allows interactive editing at tabstop locations:</p>
<ul>
<li><p>All tabstop locations are visualized depending on tabstop “state” (whether it is current/visited/unvisited/final and whether it was already edited). Empty tabstops are visualized with inline virtual text (“•”/“∎” for regular/final tabstops). It is removed after session is stopped.</p></li>
<li><p>Start session at first tabstop. Type text to replace placeholder. When finished with current tabstop, jump to next with <span class="help-syntax-keys">&lt;C-l&gt;</span>. Repeat. If changed mind about some previous tabstop, jump back with <span class="help-syntax-keys">&lt;C-h&gt;</span>. Jumping also wraps around the edge (first tabstop is next after final).</p></li>
<li><p>If tabstop has choices, use <span class="help-syntax-keys">&lt;C-n&gt;</span> / <span class="help-syntax-keys">&lt;C-p&gt;</span> to select next / previous item.</p></li>
<li><p>Starting another snippet session while there is an active one is allowed. This creates nested sessions: suspend current, start the new one. After newly created is stopped, resume the suspended one.</p></li>
<li><p>Stop session manually by pressing <span class="help-syntax-keys">&lt;C-c&gt;</span> or make it stop automatically: if final tabstop is current either make a text edit or exit to Normal mode. If snippet doesn’t explicitly define final tabstop, it is added at the end of the snippet.</p></li>
</ul>
<p>For more details about snippet session see <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-session">MiniSnippets-session</a>.</p>
<p>To select and insert snippets via completion engine (that supports LSP completion; like <a href="../../mini.nvim/doc/mini-completion.html#mini.completion">mini.completion</a> or <a href="https://neovim.io/doc/user/helptag.html?tag=lsp-autocompletion">lsp-autocompletion</a>), call <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.start_lsp_server">MiniSnippets.start_lsp_server()</a> after <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.setup">MiniSnippets.setup()</a>. This sets up an LSP server that matches and provides snippets loaded with ‘mini.snippets’. To match with completion engine, use <code>start_lsp_server({ match = false })</code>.</p>
</section>
<section id="minisnippets-overview-management" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-overview-management">Management</h4>
<p>Out of the box ‘mini.snippets’ doesn’t load any snippets, it should be done explicitly inside <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.setup">MiniSnippets.setup()</a> following <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.config">MiniSnippets.config</a>.</p>
<p>The suggested approach to snippet management is to create dedicated files with snippet data and load them through function loaders in <code>config.snippets</code>. See <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-examples">MiniSnippets-examples</a> for basic (yet capable) snippet management config.</p>
<section id="minisnippets-overview-management-filespecification" class="level5">
<h5 class="anchored" data-anchor-id="minisnippets-overview-management-filespecification">File specification</h5>
<p><a name="minisnippets-file-specification" href="../../mini.nvim/doc/mini-snippets.html#minisnippets-file-specification"><b>MiniSnippets-file-specification</b></a></p>
<p>General idea of supported files is to have at least out of the box experience with common snippet collections. Namely “rafamadriz/friendly-snippets”. The following files are supported:</p>
<ul>
<li><p>Extensions:</p>
<ul>
<li><p>Read/decoded as JSON object (<a href="https://neovim.io/doc/user/helptag.html?tag=vim.json.decode()">vim.json.decode()</a>): <code>*.json</code>, <code>*.code-snippets</code></p></li>
<li><p>Executed as Lua file (<a href="https://neovim.io/doc/user/helptag.html?tag=dofile()">dofile()</a>) and uses returned value: <code>*.lua</code></p></li>
</ul></li>
<li><p>Content:</p>
<ul>
<li><p>Dict-like: object in JSON; returned table in Lua; no order guarantees.</p></li>
<li><p>Array-like: array in JSON; returned array table in Lua; preserves order.</p></li>
</ul></li>
</ul>
<p>Example of file content with a single snippet:</p>
<ul>
<li><p>Lua dict-like: <code>return { name = { prefix = 't', body = 'Text' } }</code></p></li>
<li><p>Lua array-like: <code>return { { prefix = 't', body = 'Text', desc = 'name' } }</code></p></li>
<li><p>JSON dict-like: <code>{ "name": { "prefix": "t", "body": "Text" } }</code></p></li>
<li><p>JSON array-like: <code>[ { "prefix": "t", "body": "Text", "desc": "name" } ]</code></p></li>
</ul>
<p>Notes:</p>
<ul>
<li><p>There is no built-in support for VSCode-like “package.json” files. Define structure manually in <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.setup">MiniSnippets.setup()</a> via built-in or custom loaders.</p></li>
<li><p>There is no built-in support for <code>scope</code> field of snippet data. Snippets are expected to be manually separated into smaller files and loaded on demand.</p></li>
</ul>
<p>For supported snippet syntax see <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-syntax-specification">MiniSnippets-syntax-specification</a>.</p>
</section>
<section id="minisnippets-overview-management-generaladvice" class="level5">
<h5 class="anchored" data-anchor-id="minisnippets-overview-management-generaladvice">General advice</h5>
<ul>
<li><p>Put files in “snippets” subdirectory of any path in ‘runtimepath’ (like ‘<code>$XDG_CONFIG_HOME</code>/nvim/snippets/global.json’). This is compatible with <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.gen_loader.from_runtime">MiniSnippets.gen_loader.from_runtime()</a> and example from <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-examples">MiniSnippets-examples</a>.</p></li>
<li><p>Prefer <code>*.json</code> files with dict-like content if you want more cross platfrom setup. Otherwise use <code>*.lua</code> files with array-like content.</p></li>
<li><p>To implement “dynamic snippet” that changes data (usually <span class="help-syntax-keys">&lt;body&gt;</span>) depending on the context, use <code>*.lua</code> file with function returning snippet data. It should be an element in the output table (dict or array like).</p></li>
</ul>
</section>
</section>
<section id="minisnippets-overview-demo" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-overview-demo">Demo</h4>
<p>The best way to grasp the design of snippet management and expansion is to try them out yourself. Here are steps for a basic demo:</p>
<ul>
<li><p>Create ‘snippets/global.json’ file in the config directory with the content:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"Basic"</span><span class="fu">:</span>        <span class="fu">{</span> <span class="dt">"prefix"</span><span class="fu">:</span> <span class="st">"ba"</span><span class="fu">,</span> <span class="dt">"body"</span><span class="fu">:</span> <span class="st">"T1=$1 T2=$2 T0=$0"</span>         <span class="fu">},</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"Placeholders"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"prefix"</span><span class="fu">:</span> <span class="st">"pl"</span><span class="fu">,</span> <span class="dt">"body"</span><span class="fu">:</span> <span class="st">"T1=${1:aa}</span><span class="ch">\n</span><span class="st">T2=${2:&lt;$1&gt;}"</span>  <span class="fu">},</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"Choices"</span><span class="fu">:</span>      <span class="fu">{</span> <span class="dt">"prefix"</span><span class="fu">:</span> <span class="st">"ch"</span><span class="fu">,</span> <span class="dt">"body"</span><span class="fu">:</span> <span class="st">"T1=${1|a,b|} T2=${2|c,d|}"</span> <span class="fu">},</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"Linked"</span><span class="fu">:</span>       <span class="fu">{</span> <span class="dt">"prefix"</span><span class="fu">:</span> <span class="st">"li"</span><span class="fu">,</span> <span class="dt">"body"</span><span class="fu">:</span> <span class="st">"T1=$1</span><span class="ch">\n\t</span><span class="st">T1=$1"</span>            <span class="fu">},</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"Variables"</span><span class="fu">:</span>    <span class="fu">{</span> <span class="dt">"prefix"</span><span class="fu">:</span> <span class="st">"va"</span><span class="fu">,</span> <span class="dt">"body"</span><span class="fu">:</span> <span class="st">"Runtime: $VIMRUNTIME</span><span class="ch">\n</span><span class="st">"</span>    <span class="fu">},</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"Complex"</span><span class="fu">:</span>      <span class="fu">{</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"prefix"</span><span class="fu">:</span> <span class="st">"co"</span><span class="fu">,</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"body"</span><span class="fu">:</span> <span class="ot">[</span> <span class="st">"T1=${1:$RANDOM}"</span><span class="ot">,</span> <span class="st">"T3=${3:$1_${2:$1}}"</span><span class="ot">,</span> <span class="st">"T2=$2"</span> <span class="ot">]</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Set up ‘mini.snippets’ as recommended in <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-examples">MiniSnippets-examples</a>.</p></li>
<li><p>Open Neovim. Type each snippet prefix and press <span class="help-syntax-keys">&lt;C-j&gt;</span> (even if there is still active session). Explore from there.</p></li>
</ul>
<hr>
</section>
</section>
<section id="minisnippets-examples" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="minisnippets-examples">Examples</h3>
<section id="minisnippets-examples-basicsnippetmanagementconfig" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-examples-basicsnippetmanagementconfig">Basic snippet management config</h4>
<p>Example of snippet management setup that should cover most cases:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Setup</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">gen_loader</span> <span class="op">=</span> <span class="fu">require</span><span class="op">(</span><span class="st">'mini.snippets'</span><span class="op">).</span><span class="va">gen_loader</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span><span class="op">(</span><span class="st">'mini.snippets'</span><span class="op">).</span>setup<span class="op">({</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">snippets</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Load custom file with global snippets first</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">gen_loader</span><span class="op">.</span>from_file<span class="op">(</span><span class="st">'~/.config/nvim/snippets/global.json'</span><span class="op">),</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Load snippets based on current language by reading files from</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- "snippets/" subdirectories from 'runtimepath' directories.</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">gen_loader</span><span class="op">.</span>from_lang<span class="op">(),</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">},</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="op">})</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This setup allows having single file with custom “global” snippets (will be present in every buffer) and snippets which will be loaded based on the local language (see <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.gen_loader.from_lang">MiniSnippets.gen_loader.from_lang()</a>).</p>
<p>Create language snippets manually (by creating and populating ‘<code>$XDG_CONFIG_HOME</code>/nvim/snippets/lua.json’ file) or by installing dedicated snippet collection plugin (like ‘rafamadriz/friendly-snippets’).</p>
<p>Note: all built-in loaders and <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.read_file">MiniSnippets.read_file()</a> cache their output by default. It means that after a file is first read, changing it won’t have effect during current Neovim session. See <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.gen_loader">MiniSnippets.gen_loader</a> about how to reset cache if necessary.</p>
</section>
<section id="minisnippets-examples-selectfromallavailablesnippetsincurrentcontext" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-examples-selectfromallavailablesnippetsincurrentcontext">Select from all available snippets in current context</h4>
<p>With <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.default_match">MiniSnippets.default_match()</a>, expand snippets (<span class="help-syntax-keys">&lt;C-j&gt;</span> by default) at line start or after whitespace. To be able to always select from all current context snippets, make mapping similar to the following:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">rhs</span> <span class="op">=</span> <span class="kw">function</span><span class="op">()</span> <span class="va">MiniSnippets</span><span class="op">.</span>expand<span class="op">({</span> <span class="fu">match</span> <span class="op">=</span> <span class="kw">false</span> <span class="op">})</span> <span class="kw">end</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="va">vim</span><span class="op">.</span><span class="va">keymap</span><span class="op">.</span>set<span class="op">(</span><span class="st">'i'</span><span class="op">,</span> <span class="st">'&lt;C-g&gt;&lt;C-j&gt;'</span><span class="op">,</span> <span class="va">rhs</span><span class="op">,</span> <span class="op">{</span> <span class="va">desc</span> <span class="op">=</span> <span class="st">'Expand all'</span> <span class="op">})</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="minisnippets-examples-supertab-likespanclasshelp-syntax-keystabspanspanclasshelp-syntax-keyss-tabspanmappings" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-examples-supertab-likespanclasshelp-syntax-keystabspanspanclasshelp-syntax-keyss-tabspanmappings">“Supertab”-like <span class="help-syntax-keys">&lt;Tab&gt;</span> / <span class="help-syntax-keys">&lt;S-Tab&gt;</span> mappings</h4>
<p>This module intentionally by default uses separate keys to expand and jump as it enables cleaner use of nested sessions. Here is an example of setting up custom <span class="help-syntax-keys">&lt;Tab&gt;</span> to “expand or jump” and <span class="help-syntax-keys">&lt;S-Tab&gt;</span> to “jump to previous”:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">snippets</span> <span class="op">=</span> <span class="fu">require</span><span class="op">(</span><span class="st">'mini.snippets'</span><span class="op">)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">match_strict</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">snips</span><span class="op">)</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Do not match with whitespace to cursor's left</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="va">snippets</span><span class="op">.</span>default_match<span class="op">(</span><span class="va">snips</span><span class="op">,</span> <span class="op">{</span> <span class="va">pattern_fuzzy</span> <span class="op">=</span> <span class="st">'%S+'</span> <span class="op">})</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="va">snippets</span><span class="op">.</span>setup<span class="op">({</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- ... Set up snippets ...</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="va">mappings</span> <span class="op">=</span> <span class="op">{</span> <span class="va">expand</span> <span class="op">=</span> <span class="st">''</span><span class="op">,</span> <span class="va">jump_next</span> <span class="op">=</span> <span class="st">''</span><span class="op">,</span> <span class="va">jump_prev</span> <span class="op">=</span> <span class="st">''</span> <span class="op">},</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="va">expand</span>   <span class="op">=</span> <span class="op">{</span> <span class="fu">match</span> <span class="op">=</span> <span class="va">match_strict</span> <span class="op">},</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="op">})</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">expand_or_jump</span> <span class="op">=</span> <span class="kw">function</span><span class="op">()</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> <span class="va">can_expand</span> <span class="op">=</span> <span class="op">#</span><span class="va">MiniSnippets</span><span class="op">.</span>expand<span class="op">({</span> <span class="fu">insert</span> <span class="op">=</span> <span class="kw">false</span> <span class="op">})</span> <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="va">can_expand</span> <span class="cf">then</span> <span class="va">vim</span><span class="op">.</span>schedule<span class="op">(</span><span class="va">MiniSnippets</span><span class="op">.</span><span class="va">expand</span><span class="op">);</span> <span class="cf">return</span> <span class="st">''</span> <span class="cf">end</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> <span class="va">is_active</span> <span class="op">=</span> <span class="va">MiniSnippets</span><span class="op">.</span><span class="va">session</span><span class="op">.</span>get<span class="op">()</span> <span class="op">~=</span> <span class="kw">nil</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="va">is_active</span> <span class="cf">then</span> <span class="va">MiniSnippets</span><span class="op">.</span><span class="va">session</span><span class="op">.</span>jump<span class="op">(</span><span class="st">'next'</span><span class="op">);</span> <span class="cf">return</span> <span class="st">''</span> <span class="cf">end</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="st">'</span><span class="sc">\t</span><span class="st">'</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">jump_prev</span> <span class="op">=</span> <span class="kw">function</span><span class="op">()</span> <span class="va">MiniSnippets</span><span class="op">.</span><span class="va">session</span><span class="op">.</span>jump<span class="op">(</span><span class="st">'prev'</span><span class="op">)</span> <span class="kw">end</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="va">vim</span><span class="op">.</span><span class="va">keymap</span><span class="op">.</span>set<span class="op">(</span><span class="st">'i'</span><span class="op">,</span> <span class="st">'&lt;Tab&gt;'</span><span class="op">,</span> <span class="va">expand_or_jump</span><span class="op">,</span> <span class="op">{</span> <span class="va">expr</span> <span class="op">=</span> <span class="kw">true</span> <span class="op">})</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="va">vim</span><span class="op">.</span><span class="va">keymap</span><span class="op">.</span>set<span class="op">(</span><span class="st">'i'</span><span class="op">,</span> <span class="st">'&lt;S-Tab&gt;'</span><span class="op">,</span> <span class="va">jump_prev</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="minisnippets-examples-stopsessionimmediatelyafterjumpingtofinaltabstop" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-examples-stopsessionimmediatelyafterjumpingtofinaltabstop">Stop session immediately after jumping to final tabstop</h4>
<p>Utilize a dedicated <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-events">MiniSnippets-events</a>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">fin_stop</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">args</span><span class="op">)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="va">args</span><span class="op">.</span><span class="va">data</span><span class="op">.</span><span class="va">tabstop_to</span> <span class="op">==</span> <span class="st">'0'</span> <span class="cf">then</span> <span class="va">MiniSnippets</span><span class="op">.</span><span class="va">session</span><span class="op">.</span>stop<span class="op">()</span> <span class="cf">end</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">au_opts</span> <span class="op">=</span> <span class="op">{</span> <span class="va">pattern</span> <span class="op">=</span> <span class="st">'MiniSnippetsSessionJump'</span><span class="op">,</span> <span class="va">callback</span> <span class="op">=</span> <span class="va">fin_stop</span> <span class="op">}</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="va">vim</span><span class="op">.</span><span class="va">api</span><span class="op">.</span>nvim_create_autocmd<span class="op">(</span><span class="st">'User'</span><span class="op">,</span> <span class="va">au_opts</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="minisnippets-examples-stopallsessionsonnormalmodeexit" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-examples-stopallsessionsonnormalmodeexit">Stop all sessions on Normal mode exit</h4>
<p>Use <a href="https://neovim.io/doc/user/helptag.html?tag=ModeChanged">ModeChanged</a> and <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-events">MiniSnippets-events</a> events:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">make_stop</span> <span class="op">=</span> <span class="kw">function</span><span class="op">()</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> <span class="va">au_opts</span> <span class="op">=</span> <span class="op">{</span> <span class="va">pattern</span> <span class="op">=</span> <span class="st">'*:n'</span><span class="op">,</span> <span class="va">once</span> <span class="op">=</span> <span class="kw">true</span> <span class="op">}</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">au_opts</span><span class="op">.</span><span class="va">callback</span> <span class="op">=</span> <span class="kw">function</span><span class="op">()</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">MiniSnippets</span><span class="op">.</span><span class="va">session</span><span class="op">.</span>get<span class="op">()</span> <span class="cf">do</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>      <span class="va">MiniSnippets</span><span class="op">.</span><span class="va">session</span><span class="op">.</span>stop<span class="op">()</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="va">vim</span><span class="op">.</span><span class="va">api</span><span class="op">.</span>nvim_create_autocmd<span class="op">(</span><span class="st">'ModeChanged'</span><span class="op">,</span> <span class="va">au_opts</span><span class="op">)</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">opts</span> <span class="op">=</span> <span class="op">{</span> <span class="va">pattern</span> <span class="op">=</span> <span class="st">'MiniSnippetsSessionStart'</span><span class="op">,</span> <span class="va">callback</span> <span class="op">=</span> <span class="va">make_stop</span> <span class="op">}</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="va">vim</span><span class="op">.</span><span class="va">api</span><span class="op">.</span>nvim_create_autocmd<span class="op">(</span><span class="st">'User'</span><span class="op">,</span> <span class="va">opts</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="minisnippets-examples-customizevariableevaluation" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-examples-customizevariableevaluation">Customize variable evaluation</h4>
<p>Create environment variables and <code>config.expand.insert</code> wrapper:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Use evnironment variables with value is same for all snippet sessions</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="va">vim</span><span class="op">.</span><span class="va">loop</span><span class="op">.</span>os_setenv<span class="op">(</span><span class="st">'USERNAME'</span><span class="op">,</span> <span class="st">'user'</span><span class="op">)</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Compute custom lookup for variables with dynamic values</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">insert_with_lookup</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">snippet</span><span class="op">)</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> <span class="va">lookup</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TM_SELECTED_TEXT</span> <span class="op">=</span> <span class="fu">table.concat</span><span class="op">(</span><span class="va">vim</span><span class="op">.</span><span class="va">fn</span><span class="op">.</span>getreg<span class="op">(</span><span class="st">'a'</span><span class="op">,</span> <span class="kw">true</span><span class="op">,</span> <span class="kw">true</span><span class="op">),</span> <span class="st">'</span><span class="sc">\n</span><span class="st">'</span><span class="op">),</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="va">MiniSnippets</span><span class="op">.</span>default_insert<span class="op">(</span><span class="va">snippet</span><span class="op">,</span> <span class="op">{</span> <span class="va">lookup</span> <span class="op">=</span> <span class="va">lookup</span> <span class="op">})</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span><span class="op">(</span><span class="st">'mini.snippets'</span><span class="op">).</span>setup<span class="op">({</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- ... Set up snippets ...</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="va">expand</span> <span class="op">=</span> <span class="op">{</span> <span class="fu">insert</span> <span class="op">=</span> <span class="va">insert_with_lookup</span> <span class="op">},</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="op">})</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="minisnippets-examples-usingneovimsbuilt-instoinsertsnippet" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-examples-usingneovimsbuilt-instoinsertsnippet">Using Neovim’s built-ins to insert snippet</h4>
<p>Define custom <code>expand.insert</code> in <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.config">MiniSnippets.config</a> and mappings:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span><span class="op">(</span><span class="st">'mini.snippets'</span><span class="op">).</span>setup<span class="op">({</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- ... Set up snippets ...</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">expand</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">insert</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">snippet</span><span class="op">,</span> <span class="cn">_</span><span class="op">)</span> <span class="va">vim</span><span class="op">.</span><span class="va">snippet</span><span class="op">.</span>expand<span class="op">(</span><span class="va">snippet</span><span class="op">.</span><span class="va">body</span><span class="op">)</span> <span class="kw">end</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="op">})</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- Make jump mappings or skip to use built-in &lt;Tab&gt;/&lt;S-Tab&gt; in Neovim&gt;=0.11</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">jump_next</span> <span class="op">=</span> <span class="kw">function</span><span class="op">()</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="va">vim</span><span class="op">.</span><span class="va">snippet</span><span class="op">.</span>active<span class="op">({</span><span class="va">direction</span> <span class="op">=</span> <span class="dv">1</span><span class="op">})</span> <span class="cf">then</span> <span class="cf">return</span> <span class="va">vim</span><span class="op">.</span><span class="va">snippet</span><span class="op">.</span>jump<span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="cf">end</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">jump_prev</span> <span class="op">=</span> <span class="kw">function</span><span class="op">()</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="va">vim</span><span class="op">.</span><span class="va">snippet</span><span class="op">.</span>active<span class="op">({</span><span class="va">direction</span> <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">})</span> <span class="cf">then</span> <span class="va">vim</span><span class="op">.</span><span class="va">snippet</span><span class="op">.</span>jump<span class="op">(-</span><span class="dv">1</span><span class="op">)</span> <span class="cf">end</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="va">vim</span><span class="op">.</span><span class="va">keymap</span><span class="op">.</span>set<span class="op">({</span> <span class="st">'i'</span><span class="op">,</span> <span class="st">'s'</span> <span class="op">},</span> <span class="st">'&lt;C-l&gt;'</span><span class="op">,</span> <span class="va">jump_next</span><span class="op">)</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="va">vim</span><span class="op">.</span><span class="va">keymap</span><span class="op">.</span>set<span class="op">({</span> <span class="st">'i'</span><span class="op">,</span> <span class="st">'s'</span> <span class="op">},</span> <span class="st">'&lt;C-h&gt;'</span><span class="op">,</span> <span class="va">jump_prev</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="minisnippets-examples-usingmini.snippetsinotherplugins" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets-examples-usingmini.snippetsinotherplugins">Using ‘mini.snippets’ in other plugins</h4>
<p><a name="minisnippets-in-other-plugins" href="../../mini.nvim/doc/mini-snippets.html#minisnippets-in-other-plugins"><b>MiniSnippets-in-other-plugins</b></a></p>
<ul>
<li><p>Perform a <code>_G.MiniSnippets ~= nil</code> check before using any feature. This ensures that user explicitly set up ‘mini.snippets’.</p></li>
<li><p>To insert snippet given its body (like <a href="https://neovim.io/doc/user/helptag.html?tag=vim.snippet.expand()">vim.snippet.expand()</a>), use:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Use configured `insert` method with falling back to default</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">insert</span> <span class="op">=</span> <span class="va">MiniSnippets</span><span class="op">.</span><span class="va">config</span><span class="op">.</span><span class="va">expand</span><span class="op">.</span><span class="va">insert</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">or</span> <span class="va">MiniSnippets</span><span class="op">.</span><span class="va">default_insert</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Insert at cursor</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">insert</span><span class="op">({</span> <span class="va">body</span> <span class="op">=</span> <span class="va">snippet</span> <span class="op">})</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>To get available snippets, use:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Get snippets matched at cursor</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="va">MiniSnippets</span><span class="op">.</span>expand<span class="op">({</span> <span class="fu">insert</span> <span class="op">=</span> <span class="kw">false</span> <span class="op">})</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Get all snippets available at cursor context</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="va">MiniSnippets</span><span class="op">.</span>expand<span class="op">({</span> <span class="fu">match</span> <span class="op">=</span> <span class="kw">false</span><span class="op">,</span> <span class="fu">insert</span> <span class="op">=</span> <span class="kw">false</span> <span class="op">})</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ul>
<hr>
</section>
</section>
<section id="minisnippets.setup" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="minisnippets.setup">setup()</h3>
<p align="center">
<code>MiniSnippets.setup</code>(<span class="help-syntax-special">{config}</span>)
</p>
<p>Module setup</p>
<section id="minisnippets.setup-parameters" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.setup-parameters">Parameters</h4>
<p><span class="help-syntax-special">{config}</span> <code>(table|nil)</code> Module config table. See <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.config">MiniSnippets.config</a>.</p>
</section>
<section id="minisnippets.setup-usage" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.setup-usage">Usage</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span><span class="op">(</span><span class="st">'mini.snippets'</span><span class="op">).</span>setup<span class="op">({})</span> <span class="co">-- replace {} with your config table</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="co">-- needs `snippets` field present</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="minisnippets.config" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="minisnippets.config">config</h3>
<p align="center">
<code>MiniSnippets.config</code>
</p>
<section id="minisnippets.config-defaults" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.config-defaults">Defaults</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="va">MiniSnippets</span><span class="op">.</span><span class="va">config</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Array of snippets and loaders (see |MiniSnippets.config| for details).</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Nothing is defined by default. Add manually to have snippets to match.</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">snippets</span> <span class="op">=</span> <span class="op">{},</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Module mappings. Use `''` (empty string) to disable one.</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="va">mappings</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Expand snippet at cursor position. Created globally in Insert mode.</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="va">expand</span> <span class="op">=</span> <span class="st">'&lt;C-j&gt;'</span><span class="op">,</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Interact with default `expand.insert` session.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Created for the duration of active session(s)</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="va">jump_next</span> <span class="op">=</span> <span class="st">'&lt;C-l&gt;'</span><span class="op">,</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="va">jump_prev</span> <span class="op">=</span> <span class="st">'&lt;C-h&gt;'</span><span class="op">,</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="va">stop</span> <span class="op">=</span> <span class="st">'&lt;C-c&gt;'</span><span class="op">,</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="op">},</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Functions describing snippet expansion. If `nil`, default values</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- are `MiniSnippets.default_&lt;field&gt;()`.</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="va">expand</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Resolve raw config snippets at context</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    <span class="va">prepare</span> <span class="op">=</span> <span class="kw">nil</span><span class="op">,</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Match resolved snippets at cursor position</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">match</span> <span class="op">=</span> <span class="kw">nil</span><span class="op">,</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Possibly choose among matched snippets</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span> <span class="op">=</span> <span class="kw">nil</span><span class="op">,</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Insert selected snippet</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">insert</span> <span class="op">=</span> <span class="kw">nil</span><span class="op">,</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="op">},</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="minisnippets.config-loadedsnippets" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.config-loadedsnippets">Loaded snippets</h4>
<p><code>config.snippets</code> is an array containing snippet data which can be: snippet table, function loader, or (however deeply nested) array of snippet data.</p>
<p>Snippet is a table with the following fields:</p>
<ul>
<li><p><span class="help-syntax-keys">&lt;prefix&gt;</span> <code>(string|table|nil)</code> - string used to match against current text. If array, all strings should be used as separate prefixes.</p></li>
<li><p><span class="help-syntax-keys">&lt;body&gt;</span> <code>(string|table|nil)</code> - content of a snippet which should follow the <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-syntax-specification">MiniSnippets-syntax-specification</a>. Array is concatenated with <code>"\n"</code>.</p></li>
<li><p><span class="help-syntax-keys">&lt;desc&gt;</span> <code>(string|table|nil)</code> - description of snippet. Can be used to display snippets in a more human readable form. Array is concatenated with <code>"\n"</code>.</p></li>
</ul>
<p>Function loaders are expected to be called with single <code>context</code> table argument (containing any data about current context) and return same as <code>config.snippets</code> data structure.</p>
<p><code>config.snippets</code> is resolved with <code>config.prepare</code> on every expand. See <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.default_prepare">MiniSnippets.default_prepare()</a> for how it is done by default.</p>
<p>For a practical example see <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-examples">MiniSnippets-examples</a>. Here is an illustration of <code>config.snippets</code> customization capabilities:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">gen_loader</span> <span class="op">=</span> <span class="fu">require</span><span class="op">(</span><span class="st">'mini.snippets'</span><span class="op">).</span><span class="va">gen_loader</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span><span class="op">(</span><span class="st">'mini.snippets'</span><span class="op">).</span>setup<span class="op">({</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">snippets</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Load custom file with global snippets first (order matters)</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">gen_loader</span><span class="op">.</span>from_file<span class="op">(</span><span class="st">'~/.config/nvim/snippets/global.json'</span><span class="op">),</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Or add them here explicitly</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="va">prefix</span><span class="op">=</span><span class="st">'cdate'</span><span class="op">,</span> <span class="va">body</span><span class="op">=</span><span class="st">'$CURRENT_YEAR-$CURRENT_MONTH-$CURRENT_DATE'</span> <span class="op">},</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Load snippets based on current language by reading files from</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- "snippets/" subdirectories from 'runtimepath' directories.</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="va">gen_loader</span><span class="op">.</span>from_lang<span class="op">(),</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Load project-local snippets with `gen_loader.from_file()`</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- and relative path (file doesn't have to be present)</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="va">gen_loader</span><span class="op">.</span>from_file<span class="op">(</span><span class="st">'.vscode/project.code-snippets'</span><span class="op">),</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Custom loader for language-specific project-local snippets</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span><span class="op">(</span><span class="va">context</span><span class="op">)</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>      <span class="kw">local</span> <span class="va">rel_path</span> <span class="op">=</span> <span class="st">'.vscode/'</span> <span class="op">..</span> <span class="va">context</span><span class="op">.</span><span class="va">lang</span> <span class="op">..</span> <span class="st">'.code-snippets'</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="va">vim</span><span class="op">.</span><span class="va">fn</span><span class="op">.</span>filereadable<span class="op">(</span><span class="va">rel_path</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span> <span class="cf">then</span> <span class="cf">return</span> <span class="cf">end</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="va">MiniSnippets</span><span class="op">.</span>read_file<span class="op">(</span><span class="va">rel_path</span><span class="op">)</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span><span class="op">,</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Ensure that some prefixes are not used (as there is no `body`)</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="va">prefix</span> <span class="op">=</span> <span class="op">{</span> <span class="st">'bad'</span><span class="op">,</span> <span class="st">'prefix'</span> <span class="op">}</span> <span class="op">},</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="op">})</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="minisnippets.config-mappings" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.config-mappings">Mappings</h4>
<p><code>config.mappings</code> describes which mappings are automatically created.</p>
<p><code>mappings.expand</code> is created globally in Insert mode and is used to expand snippet at cursor. Use <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.expand">MiniSnippets.expand()</a> for custom mappings.</p>
<p><code>mappings.jump_next</code>, <code>mappings.jump_prev</code>, and <code>mappings.stop</code> are created for the duration of active snippet session(s) from <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.default_insert">MiniSnippets.default_insert()</a>. Used to jump to next/previous tabstop and stop active session respectively. Use <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.session.jump">MiniSnippets.session.jump()</a> and <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.session.stop">MiniSnippets.session.stop()</a> for custom Insert mode mappings. Note: do not use <code>"&lt;C-n&gt;"</code> or <code>"&lt;C-p&gt;"</code> for any action as they conflict with built-in completion: it forces them to mean “change focus to next/previous completion item”. This matters more frequently than when there is a tabstop with choices due to how this module handles built-in completion during jumps.</p>
</section>
<section id="minisnippets.config-expand" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.config-expand">Expand</h4>
<p><code>config.expand</code> defines expand steps (see <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-glossary">MiniSnippets-glossary</a>), either after pressing <code>mappings.expand</code> or starting manually via <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.expand">MiniSnippets.expand()</a>.</p>
<p><code>expand.prepare</code> is a function that takes <code>raw_snippets</code> in the form of <code>config.snippets</code> and should return a plain array of snippets (as described in <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-glossary">MiniSnippets-glossary</a>). Will be called on every <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.expand">MiniSnippets.expand()</a> call. If returns second value, it will be used as context for warning messages. Default: <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.default_prepare">MiniSnippets.default_prepare()</a>.</p>
<p><code>expand.match</code> is a function that takes <code>expand.prepare</code> output and returns an array of matched snippets: one or several snippets user might intend to eventually insert. Should sort matches in output from best to worst. Entries can contain <code>region</code> field with current buffer region used to do the match; usually it needs to be removed (similar to how <a href="https://neovim.io/doc/user/helptag.html?tag=ins-completion">ins-completion</a> and <a href="https://neovim.io/doc/user/helptag.html?tag=abbreviations">abbreviations</a> work). Default: <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.default_match">MiniSnippets.default_match()</a></p>
<p><code>expand.select</code> is a function that takes output of <code>expand.match</code> and function that inserts snippet (and also ensures Insert mode and removes snippet’s match region). Should allow user to perform interactive snippet selection and insert the chosen one. Designed to be compatible with <a href="https://neovim.io/doc/user/helptag.html?tag=vim.ui.select()">vim.ui.select()</a>. Called for any non-empty <code>expand.match</code> output (even with single entry). Default: <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.default_select">MiniSnippets.default_select()</a></p>
<p><code>expand.insert</code> is a function that takes single snippet table as input and inserts snippet at cursor position. This is a main entry point for adding text template to buffer and starting a snippet session. If called inside <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.expand">MiniSnippets.expand()</a> (which is a usual interactive case), all it has to do is insert snippet at cursor position. Ensuring Insert mode and removing matched snippet region is done beforehand. Default: <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.default_insert">MiniSnippets.default_insert()</a></p>
<p>Illustration of <code>config.expand</code> customization:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Supply extra data as context</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">my_p</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">raw_snippets</span><span class="op">)</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> <span class="cn">_</span><span class="op">,</span> <span class="va">cont</span> <span class="op">=</span> <span class="va">MiniSnippets</span><span class="op">.</span>default_prepare<span class="op">({})</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">cont</span><span class="op">.</span><span class="va">cursor</span> <span class="op">=</span> <span class="va">vim</span><span class="op">.</span><span class="va">api</span><span class="op">.</span>nvim_win_get_cursor<span class="op">()</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="va">MiniSnippets</span><span class="op">.</span>default_prepare<span class="op">(</span><span class="va">raw_snippets</span><span class="op">,</span> <span class="op">{</span> <span class="va">context</span> <span class="op">=</span> <span class="va">cont</span> <span class="op">})</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- Perform fuzzy match based only on alphanumeric characters</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">my_m</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">snippets</span><span class="op">)</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="va">MiniSnippets</span><span class="op">.</span>default_match<span class="op">(</span><span class="va">snippets</span><span class="op">,</span> <span class="op">{</span> <span class="va">pattern_fuzzy</span> <span class="op">=</span> <span class="st">'%w*'</span> <span class="op">})</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- Always insert the best matched snippet</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">my_s</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">snippets</span><span class="op">,</span> <span class="fu">insert</span><span class="op">)</span> <span class="cf">return</span> <span class="fu">insert</span><span class="op">(</span><span class="va">snippets</span><span class="op">[</span><span class="dv">1</span><span class="op">])</span> <span class="kw">end</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">-- Use different string to show empty tabstop as inline virtual text</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">my_i</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">snippet</span><span class="op">)</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="va">MiniSnippets</span><span class="op">.</span>default_insert<span class="op">(</span><span class="va">snippet</span><span class="op">,</span> <span class="op">{</span> <span class="va">empty_tabstop</span> <span class="op">=</span> <span class="st">'$'</span> <span class="op">})</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span><span class="op">(</span><span class="st">'mini.snippets'</span><span class="op">).</span>setup<span class="op">({</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- ... Set up snippets ...</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="va">expand</span> <span class="op">=</span> <span class="op">{</span> <span class="va">prepare</span> <span class="op">=</span> <span class="va">my_p</span><span class="op">,</span> <span class="fu">match</span> <span class="op">=</span> <span class="va">my_m</span><span class="op">,</span> <span class="fu">select</span> <span class="op">=</span> <span class="va">my_s</span><span class="op">,</span> <span class="fu">insert</span> <span class="op">=</span> <span class="va">my_i</span> <span class="op">}</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="op">})</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="minisnippets.expand" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="minisnippets.expand">expand()</h3>
<p align="center">
<code>MiniSnippets.expand</code>(<span class="help-syntax-special">{opts}</span>)
</p>
<p>Expand snippet at cursor position</p>
<p>Perform expand steps (see <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-glossary">MiniSnippets-glossary</a>). Initial raw snippets are taken from <code>config.snippets</code> in current buffer. Snippets from <code>vim.b.minisnippets_config</code> are appended to global snippet array.</p>
<section id="minisnippets.expand-parameters" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.expand-parameters">Parameters</h4>
<p><span class="help-syntax-special">{opts}</span> <code>(table|nil)</code> Options. Same structure as <code>expand</code> in <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.config">MiniSnippets.config</a> and uses its values as default. There are differences in allowed values:</p>
<ul>
<li><p>Use <code>match = false</code> to have all buffer snippets as matches.</p></li>
<li><p>Use <code>select = false</code> to always expand the best match (if any).</p></li>
<li><p>Use <code>insert = false</code> to return all matches without inserting.</p></li>
</ul>
<p>Note: <code>opts.insert</code> is called after ensuring Insert mode, removing snippet’s match region, and positioning cursor.</p>
</section>
<section id="minisnippets.expand-return" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.expand-return">Return</h4>
<p><code>(table|nil)</code> If <code>insert</code> is <code>false</code>, an array of matched snippets (<code>expand.match</code> output). Otherwise <code>nil</code>.</p>
</section>
<section id="minisnippets.expand-usage" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.expand-usage">Usage</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Match, maybe select, and insert</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="va">MiniSnippets</span><span class="op">.</span>expand<span class="op">()</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Match and force expand the best match (if any)</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="va">MiniSnippets</span><span class="op">.</span>expand<span class="op">({</span> <span class="fu">select</span> <span class="op">=</span> <span class="kw">false</span> <span class="op">})</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- Use all current context snippets as matches</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="va">MiniSnippets</span><span class="op">.</span>expand<span class="op">({</span> <span class="fu">match</span> <span class="op">=</span> <span class="kw">false</span> <span class="op">})</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">-- Get all matched snippets</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">matches</span> <span class="op">=</span> <span class="va">MiniSnippets</span><span class="op">.</span>expand<span class="op">({</span> <span class="fu">insert</span> <span class="op">=</span> <span class="kw">false</span> <span class="op">})</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">-- Get all current context snippets</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">all</span> <span class="op">=</span> <span class="va">MiniSnippets</span><span class="op">.</span>expand<span class="op">({</span> <span class="fu">match</span> <span class="op">=</span> <span class="kw">false</span><span class="op">,</span> <span class="fu">insert</span> <span class="op">=</span> <span class="kw">false</span> <span class="op">})</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="minisnippets.expand-seealso" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.expand-seealso">See also</h4>
<p><a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.start_lsp_server">MiniSnippets.start_lsp_server()</a> to instead show loaded snippets in (auto)completion engines (like <a href="../../mini.nvim/doc/mini-completion.html#mini.completion">mini.completion</a>).</p>
<hr>
</section>
</section>
<section id="minisnippets.gen_loader" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="minisnippets.gen_loader">gen_loader</h3>
<p align="center">
<code>MiniSnippets.gen_loader</code>
</p>
<p>Generate snippet loader</p>
<p>This is a table with function elements. Call to actually get a loader.</p>
<p>Common features for all produced loaders:</p>
<ul>
<li><p>Designed to work with <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-file-specification">MiniSnippets-file-specification</a>.</p></li>
<li><p>Cache output by default, i.e.&nbsp;second and later calls with same input value don’t read file system. Different loaders from same generator share cache. Disable by setting <code>opts.cache</code> to <code>false</code>. To clear all cache, call <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.setup">MiniSnippets.setup()</a>. For example:</p>
<p align="center">
</p><p><code>MiniSnippets.setup(MiniSnippets.config)</code></p>
<p></p></li>
<li><p>Use <a href="https://neovim.io/doc/user/helptag.html?tag=vim.notify()">vim.notify()</a> to show problems during loading while trying to load as much correctly defined snippet data as possible. Disable by setting <code>opts.silent</code> to <code>true</code>.</p></li>
</ul>
<hr>
</section>
<section id="minisnippets.gen_loader.from_lang" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="minisnippets.gen_loader.from_lang">gen_loader.from_lang()</h3>
<p align="center">
<code>MiniSnippets.gen_loader.from_lang</code>(<span class="help-syntax-special">{opts}</span>)
</p>
<p>Generate language loader</p>
<p>Output loads files from “snippets/” subdirectories of ‘runtimepath’ matching configured language patterns. See <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.gen_loader.from_runtime">MiniSnippets.gen_loader.from_runtime()</a> for runtime loading details.</p>
<p>Language is taken from <span class="help-syntax-keys">&lt;lang&gt;</span> field (if present with string value) of <code>context</code> argument used in loader calls during “prepare” stage. This is compatible with <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.default_prepare">MiniSnippets.default_prepare()</a> and most snippet collection plugins.</p>
<section id="minisnippets.gen_loader.from_lang-parameters" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.gen_loader.from_lang-parameters">Parameters</h4>
<p><span class="help-syntax-special">{opts}</span> <code>(table|nil)</code> Options. Possible values:</p>
<ul>
<li><p><span class="help-syntax-keys">&lt;lang_patterns&gt;</span> <code>(table)</code> - map from language to array of runtime patterns used to find snippet files, as in <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.gen_loader.from_runtime">MiniSnippets.gen_loader.from_runtime()</a>. Patterns will be processed in order. With <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.default_prepare">MiniSnippets.default_prepare()</a> it means if snippets have same prefix, data from later patterns is used. To interactively check the current language with default context, execute <code>:=MiniSnippets.default_prepare({})</code> and see data in the second table.</p>
<p>Default pattern array (for non-empty language) is constructed as to read <code>*.json</code> and <code>*.lua</code> files that are:</p>
<ul>
<li><p>Inside “snippets/” subdirectory named as language (files can be however deeply nested).</p></li>
<li><p>Named as language and is in “snippets/” directory (however deep). Example for “lua” language:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span> <span class="st">'lua/**/*.json'</span><span class="op">,</span> <span class="st">'lua/**/*.lua'</span><span class="op">,</span> <span class="st">'**/lua.json'</span><span class="op">,</span> <span class="st">'**/lua.lua'</span> <span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ul>
<p>Add entry for <code>""</code> (empty string) as language to be sourced when <code>lang</code> context is empty string (which is usually temporary scratch buffers).</p></li>
<li><p><span class="help-syntax-keys">&lt;cache&gt;</span> <code>(boolean)</code> - whether to use cached output. Default: <code>true</code>. Note: caching is done per used runtime pattern, not <code>lang</code> value to allow different <code>from_lang()</code> loaders to share cache.</p></li>
<li><p><span class="help-syntax-keys">&lt;silent&gt;</span> <code>(boolean)</code> - whether to hide non-error messages. Default: <code>false</code>.</p></li>
</ul>
</section>
<section id="minisnippets.gen_loader.from_lang-return" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.gen_loader.from_lang-return">Return</h4>
<p><code>(function)</code> Snippet loader.</p>
</section>
<section id="minisnippets.gen_loader.from_lang-usage" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.gen_loader.from_lang-usage">Usage</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Adjust language patterns</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">latex_patterns</span> <span class="op">=</span> <span class="op">{</span> <span class="st">'latex/**/*.json'</span><span class="op">,</span> <span class="st">'**/latex.json'</span> <span class="op">}</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">lang_patterns</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">tex</span> <span class="op">=</span> <span class="va">latex_patterns</span><span class="op">,</span> <span class="va">plaintex</span> <span class="op">=</span> <span class="va">latex_patterns</span><span class="op">,</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Recognize special injected language of markdown tree-sitter parser</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="va">markdown_inline</span> <span class="op">=</span> <span class="op">{</span> <span class="st">'markdown.json'</span> <span class="op">},</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">gen_loader</span> <span class="op">=</span> <span class="fu">require</span><span class="op">(</span><span class="st">'mini.snippets'</span><span class="op">).</span><span class="va">gen_loader</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span><span class="op">(</span><span class="st">'mini.snippets'</span><span class="op">).</span>setup<span class="op">({</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="va">snippets</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="va">gen_loader</span><span class="op">.</span>from_lang<span class="op">({</span> <span class="va">lang_patterns</span> <span class="op">=</span> <span class="va">lang_patterns</span> <span class="op">}),</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">},</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="op">})</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="minisnippets.gen_loader.from_runtime" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="minisnippets.gen_loader.from_runtime">gen_loader.from_runtime()</h3>
<p align="center">
<code>MiniSnippets.gen_loader.from_runtime</code>(<span class="help-syntax-special">{pattern}</span>, <span class="help-syntax-special">{opts}</span>)
</p>
<p>Generate runtime loader</p>
<p>Output loads files which match <code>pattern</code> inside “snippets/” directories from ‘runtimepath’. This is useful to simultaneously read several similarly named files from different sources. Order from ‘runtimepath’ is preserved.</p>
<p>Typical case is loading snippets for a language from files like <code>xxx.{json,lua}</code> but located in different “snippets/” directories inside ‘runtimepath’.</p>
<ul>
<li><p><code>&lt;config&gt;</code>/snippets/lua.json - manually curated snippets in user config.</p></li>
<li><p><code>&lt;path/to/installed/plugin&gt;</code>/snippets/lua.json - from installed plugin.</p></li>
<li><p><code>&lt;config&gt;</code>/after/snippets/lua.json - used to adjust snippets from plugins. For example, remove some snippets by using prefixes and no body.</p></li>
</ul>
<section id="minisnippets.gen_loader.from_runtime-parameters" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.gen_loader.from_runtime-parameters">Parameters</h4>
<p><span class="help-syntax-special">{pattern}</span> <code>(string)</code> Pattern of files to read. Can have wildcards as described in <a href="https://neovim.io/doc/user/helptag.html?tag=nvim_get_runtime_file()">nvim_get_runtime_file()</a>. Example for “lua” language: <code>'lua.{json,lua}'</code>.</p>
<p><span class="help-syntax-special">{opts}</span> <code>(table|nil)</code> Options. Possible fields:</p>
<ul>
<li><p><span class="help-syntax-keys">&lt;all&gt;</span> <code>(boolean)</code> - whether to load from all matching runtime files. Default: <code>true</code>.</p></li>
<li><p><span class="help-syntax-keys">&lt;cache&gt;</span> <code>(boolean)</code> - whether to use cached output. Default: <code>true</code>. Note: caching is done per <code>pattern</code> value, which assumes that both ‘runtimepath’ value and snippet files do not change during Neovim session. Caching this way gives significant speed improvement by reducing the need to traverse file system on every snippet expand.</p></li>
<li><p><span class="help-syntax-keys">&lt;silent&gt;</span> <code>(boolean)</code> - whether to hide non-error messages. Default: <code>false</code>.</p></li>
</ul>
</section>
<section id="minisnippets.gen_loader.from_runtime-return" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.gen_loader.from_runtime-return">Return</h4>
<p><code>(function)</code> Snippet loader.</p>
<hr>
</section>
</section>
<section id="minisnippets.gen_loader.from_file" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="minisnippets.gen_loader.from_file">gen_loader.from_file()</h3>
<p align="center">
<code>MiniSnippets.gen_loader.from_file</code>(<span class="help-syntax-special">{path}</span>, <span class="help-syntax-special">{opts}</span>)
</p>
<p>Generate single file loader</p>
<p>Output is a thin wrapper around <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.read_file">MiniSnippets.read_file()</a> which will skip warning if file is absent (other messages are still shown). Use it to load file which is not guaranteed to exist (like project-local snippets).</p>
<section id="minisnippets.gen_loader.from_file-parameters" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.gen_loader.from_file-parameters">Parameters</h4>
<p><span class="help-syntax-special">{path}</span> <code>(string)</code> Same as in <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.read_file">MiniSnippets.read_file()</a>.</p>
<p><span class="help-syntax-special">{opts}</span> <code>(table|nil)</code> Same as in <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.read_file">MiniSnippets.read_file()</a>.</p>
</section>
<section id="minisnippets.gen_loader.from_file-return" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.gen_loader.from_file-return">Return</h4>
<p><code>(function)</code> Snippet loader.</p>
<hr>
</section>
</section>
<section id="minisnippets.read_file" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="minisnippets.read_file">read_file()</h3>
<p align="center">
<code>MiniSnippets.read_file</code>(<span class="help-syntax-special">{path}</span>, <span class="help-syntax-special">{opts}</span>)
</p>
<p>Read file with snippet data</p>
<section id="minisnippets.read_file-parameters" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.read_file-parameters">Parameters</h4>
<p><span class="help-syntax-special">{path}</span> <code>(string)</code> Path to file with snippets. Can be relative. See <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-file-specification">MiniSnippets-file-specification</a> for supported file formats.</p>
<p><span class="help-syntax-special">{opts}</span> <code>(table|nil)</code> Options. Possible fields:</p>
<ul>
<li><p><span class="help-syntax-keys">&lt;cache&gt;</span> <code>(boolean)</code> - whether to use cached output. Default: <code>true</code>. Note: Caching is done per full path only after successful reading.</p></li>
<li><p><span class="help-syntax-keys">&lt;silent&gt;</span> <code>(boolean)</code> - whether to hide non-error messages. Default: <code>false</code>.</p></li>
</ul>
</section>
<section id="minisnippets.read_file-return" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.read_file-return">Return</h4>
<p><code>(table|nil)</code> Array of snippets or <code>nil</code> if failed (also warn with <a href="https://neovim.io/doc/user/helptag.html?tag=vim.notify()">vim.notify()</a> about the reason).</p>
<hr>
</section>
</section>
<section id="minisnippets.default_prepare" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="minisnippets.default_prepare">default_prepare()</h3>
<p align="center">
<code>MiniSnippets.default_prepare</code>(<span class="help-syntax-special">{raw_snippets}</span>, <span class="help-syntax-special">{opts}</span>)
</p>
<p>Default prepare</p>
<p>Normalize raw snippets (as in <code>snippets</code> from <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.config">MiniSnippets.config</a>) based on supplied context:</p>
<ul>
<li><p>Traverse and flatten nested arrays. Function loaders are executed with <code>opts.context</code> as argument and output is processed recursively.</p></li>
<li><p>Ensure unique non-empty prefixes: later ones completely override earlier ones (similar to how <a href="https://neovim.io/doc/user/helptag.html?tag=ftplugin">ftplugin</a> and similar runtime design behave). Empty string prefixes are all added (to allow inserting without matching).</p></li>
<li><p>Transform and infer fields:</p>
<ul>
<li><p>Multiply array <code>prefix</code> into several snippets with same body/description. Infer absent <code>prefix</code> as empty string.</p></li>
<li><p>Concatenate array <code>body</code> with <code>"\n"</code>. Do not infer absent <code>body</code> to have it remove previously added snippet with the same prefix.</p></li>
<li><p>Concatenate array <code>desc</code> with <code>"\n"</code>. Infer <code>desc</code> field from <code>description</code> (for compatibility) or <code>body</code> fields, in that order.</p></li>
</ul></li>
<li><p>Sort output by prefix.</p></li>
</ul>
<p>Unlike <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.gen_loader">MiniSnippets.gen_loader</a> entries, there is no output caching. This avoids duplicating data from <code>gen_loader</code> cache and reduces memory usage. It also means that every <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.expand">MiniSnippets.expand()</a> call prepares snippets, which is usually fast enough. If not, consider manual caching:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">cache</span> <span class="op">=</span> <span class="op">{}</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">prepare_cached</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">raw_snippets</span><span class="op">)</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> <span class="cn">_</span><span class="op">,</span> <span class="va">cont</span> <span class="op">=</span> <span class="va">MiniSnippets</span><span class="op">.</span>default_prepare<span class="op">({})</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> <span class="va">id</span> <span class="op">=</span> <span class="st">'buf='</span> <span class="op">..</span> <span class="va">cont</span><span class="op">.</span><span class="va">buf_id</span> <span class="op">..</span> <span class="st">',lang='</span> <span class="op">..</span> <span class="va">cont</span><span class="op">.</span><span class="va">lang</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="va">cache</span><span class="op">[</span><span class="va">id</span><span class="op">]</span> <span class="cf">then</span> <span class="cf">return</span> <span class="fu">unpack</span><span class="op">(</span><span class="va">vim</span><span class="op">.</span>deepcopy<span class="op">(</span><span class="va">cache</span><span class="op">[</span><span class="va">id</span><span class="op">]))</span> <span class="cf">end</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> <span class="va">snippets</span> <span class="op">=</span> <span class="va">MiniSnippets</span><span class="op">.</span>default_prepare<span class="op">(</span><span class="va">raw_snippets</span><span class="op">)</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="va">cache</span><span class="op">[</span><span class="va">id</span><span class="op">]</span> <span class="op">=</span> <span class="va">vim</span><span class="op">.</span>deepcopy<span class="op">({</span> <span class="va">snippets</span><span class="op">,</span> <span class="va">cont</span> <span class="op">})</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="va">snippets</span><span class="op">,</span> <span class="va">cont</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="minisnippets.default_prepare-parameters" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.default_prepare-parameters">Parameters</h4>
<p><span class="help-syntax-special">{raw_snippets}</span> <code>(table)</code> Array of snippet data as from <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.config">MiniSnippets.config</a>.</p>
<p><span class="help-syntax-special">{opts}</span> <code>(table|nil)</code> Options. Possible fields:</p>
<ul>
<li><span class="help-syntax-keys">&lt;context&gt;</span> <code>(any)</code> - Context used as an argument for callable snippet data. Default: table with <span class="help-syntax-keys">&lt;buf_id&gt;</span> (current buffer identifier) and <span class="help-syntax-keys">&lt;lang&gt;</span> (local language) fields. Language is computed from tree-sitter parser at cursor (allows different snippets in injected languages), ‘filetype’ otherwise.</li>
</ul>
</section>
<section id="minisnippets.default_prepare-return" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.default_prepare-return">Return</h4>
<p><code>(...)</code> Array of snippets and supplied context (default if none was supplied).</p>
<hr>
</section>
</section>
<section id="minisnippets.default_match" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="minisnippets.default_match">default_match()</h3>
<p align="center">
<code>MiniSnippets.default_match</code>(<span class="help-syntax-special">{snippets}</span>, <span class="help-syntax-special">{opts}</span>)
</p>
<p>Default match</p>
<p>Match snippets based on the line before cursor.</p>
<p>Tries two matching approaches consecutively:</p>
<ul>
<li><p>Find exact snippet prefix (if present and non-empty) to the left of cursor. It should also be preceded with a byte that matches <code>pattern_exact_boundary</code>. In case of any match, return the one with the longest prefix.</p></li>
<li><p>Match fuzzily snippet prefixes against the base (text to the left of cursor extracted via <code>opts.pattern_fuzzy</code>). Matching is done via <a href="https://neovim.io/doc/user/helptag.html?tag=matchfuzzy()">matchfuzzy()</a>. Empty base results in all snippets being matched. Return all fuzzy matches.</p></li>
</ul>
<section id="minisnippets.default_match-parameters" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.default_match-parameters">Parameters</h4>
<p><span class="help-syntax-special">{snippets}</span> <code>(table)</code> Array of snippets which can be matched.</p>
<p><span class="help-syntax-special">{opts}</span> <code>(table|nil)</code> Options. Possible fields:</p>
<ul>
<li><p><span class="help-syntax-keys">&lt;pattern_exact_boundary&gt;</span> <code>(string)</code> - Lua pattern for the byte to the left of exact match to accept it. Line start is matched against empty string; use <code>?</code> quantifier to allow it as boundary. Default: <code>[%s%p]?</code> (accept only whitespace and punctuation as boundary, allow match at line start). Example: prefix “l” matches in lines <code>l</code>, <code>_l</code>, <code>x l</code>; but not <code>1l</code>, <code>ll</code>.</p></li>
<li><p><span class="help-syntax-keys">&lt;pattern_fuzzy&gt;</span> <code>(string)</code> - Lua pattern to extract base to the left of cursor for fuzzy matching. Supply empty string to skip this step. Default: <code>'%S*'</code> (as many as possible non-whitespace; allow empty string).</p></li>
</ul>
</section>
<section id="minisnippets.default_match-return" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.default_match-return">Return</h4>
<p><code>(table)</code> Array of matched snippets ordered from best to worst match.</p>
</section>
<section id="minisnippets.default_match-usage" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.default_match-usage">Usage</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Accept any exact match</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="va">MiniSnippets</span><span class="op">.</span>default_match<span class="op">(</span><span class="va">snippets</span><span class="op">,</span> <span class="op">{</span> <span class="va">pattern_exact_boundary</span> <span class="op">=</span> <span class="st">'.?'</span> <span class="op">})</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Perform fuzzy match based only on alphanumeric characters</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="va">MiniSnippets</span><span class="op">.</span>default_match<span class="op">(</span><span class="va">snippets</span><span class="op">,</span> <span class="op">{</span> <span class="va">pattern_fuzzy</span> <span class="op">=</span> <span class="st">'%w*'</span> <span class="op">})</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="minisnippets.default_select" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="minisnippets.default_select">default_select()</h3>
<p align="center">
<code>MiniSnippets.default_select</code>(<span class="help-syntax-special">{snippets}</span>, <span class="help-syntax-special">{insert}</span>, <span class="help-syntax-special">{opts}</span>)
</p>
<p>Default select</p>
<p>Show snippets as <a href="https://neovim.io/doc/user/helptag.html?tag=vim.ui.select()">vim.ui.select()</a> items and insert the chosen one. For best interactive experience requires <code>vim.ui.select()</code> to work from Insert mode (be properly called and restore Insert mode after choice). This is the case for at least <a href="../../mini.nvim/doc/mini-pick.html#minipick.ui_select">MiniPick.ui_select()</a> and Neovim’s default.</p>
<section id="minisnippets.default_select-parameters" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.default_select-parameters">Parameters</h4>
<p><span class="help-syntax-special">{snippets}</span> <code>(table)</code> Array of snippets (as an output of <code>config.expand.match</code>).</p>
<p><span class="help-syntax-special">{insert}</span> <code>(function|nil)</code> Function to insert chosen snippet (passed as the only argument). Expected to remove snippet’s match region (if present as a field) and ensure proper cursor position in Insert mode. Default: <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.default_insert">MiniSnippets.default_insert()</a>.</p>
<p><span class="help-syntax-special">{opts}</span> <code>(table|nil)</code> Options. Possible fields:</p>
<ul>
<li><span class="help-syntax-keys">&lt;insert_single&gt;</span> <code>(boolean)</code> - whether to skip <a href="https://neovim.io/doc/user/helptag.html?tag=vim.ui.select()">vim.ui.select()</a> for <code>snippets</code> with a single entry and insert it directly. Default: <code>true</code>.</li>
</ul>
<hr>
</section>
</section>
<section id="minisnippets.default_insert" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="minisnippets.default_insert">default_insert()</h3>
<p align="center">
<code>MiniSnippets.default_insert</code>(<span class="help-syntax-special">{snippet}</span>, <span class="help-syntax-special">{opts}</span>)
</p>
<p>Default insert</p>
<p>Prepare for snippet insert and do it:</p>
<ul>
<li><p>Ensure Insert mode.</p></li>
<li><p>Delete snippet’s match region (if present as <span class="help-syntax-keys">&lt;region&gt;</span> field). Ensure cursor.</p></li>
<li><p>Parse snippet body with <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.parse">MiniSnippets.parse()</a> and enabled <code>normalize</code>. In particular, evaluate variables, ensure final node presence and same text for nodes with same tabstops. Stop if not able to.</p></li>
<li><p>Insert snippet at cursor:</p>
<ul>
<li><p>Add snippet’s text. Lines are split at “”. Indent and left comment leaders (inferred from ‘commentstring’ and ‘comments’) of current line are repeated on the next. Tabs (“) are expanded according to ‘expandtab’ and ‘shiftwidth’.</p></li>
<li><p>If there is an actionable tabstop (not final), start snippet session.</p></li>
</ul></li>
</ul>
<section id="minisnippets.default_insert-sessionlifecycle" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.default_insert-sessionlifecycle">Session life cycle</h4>
<p><a name="minisnippets-session" href="../../mini.nvim/doc/mini-snippets.html#minisnippets-session"><b>MiniSnippets-session</b></a></p>
<ul>
<li><p>Start with cursor at first tabstop. If there are linked tabstops, cursor is placed at start of reference node (see <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-glossary">MiniSnippets-glossary</a>). All tabstops are visualized with dedicated highlight groups (see “Highlight groups” section in <a href="../../mini.nvim/doc/mini-snippets.html#mini.snippets">mini.snippets</a>). Empty tabstops are visualized with inline virtual text (“•”/“∎” for regular/final tabstops) meaning that it is not an actual text in the buffer and will be removed after session is stopped.</p></li>
<li><p>Decide whether you want to replace the placeholder. If not, jump to next or previous tabstop. If yes, edit it: add new and/or delete already added text. While doing so, several things happen in all linked tabstops (if any):</p>
<ul>
<li><p>After first typed character the placeholder is removed and highlighting changes from <code>MiniSnippetsCurrentReplace</code> to <code>MiniSnippetsCurrent</code>.</p></li>
<li><p>Text in all tabstop nodes is synchronized with the reference one. Relative indent of reference tabstop’s text is preserved: all but first lines in linked tabstops are reindented based on the first line indent. Note: text sync is forced only for current tabstop (for performance).</p></li>
</ul></li>
<li><p>Jump with <span class="help-syntax-keys">&lt;C-l&gt;</span> / <span class="help-syntax-keys">&lt;C-h&gt;</span> to next / previous tabstop. Exact keys can be adjusted in <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.config">MiniSnippets.config</a> <code>mappings</code>. See <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.session.jump">MiniSnippets.session.jump()</a> for jumping details.</p></li>
<li><p>If tabstop has choices, all of them are shown after each jump and deleting tabstop text. It is done with <a href="https://neovim.io/doc/user/helptag.html?tag=complete()">complete()</a>, so use <span class="help-syntax-keys">&lt;C-n&gt;</span> / <span class="help-syntax-keys">&lt;C-p&gt;</span> to select next / previous choice. Type text to narrow down the list. Works best when ‘completeopt’ option contains <code>menuone</code> and <code>noselect</code> flags. Note: deleting character hides the list due to how <a href="https://neovim.io/doc/user/helptag.html?tag=complete()">complete()</a> works; delete whole tabstop text (for example with one or more <a href="https://neovim.io/doc/user/helptag.html?tag=i_CTRL-W">i_CTRL-W</a>) for full list to reappear.</p></li>
<li><p>Nest another session by expanding snippet in the same way as without active session (can be even done in another buffer). If snippet has no actionable tabstop, text is just inserted. Otherwise start nested session:</p>
<ul>
<li><p>Suspend current session: hide highlights, keep text change tracking.</p></li>
<li><p>Start new session and act as if it is the only one (edit/jump/nest).</p></li>
<li><p>When ready (possibly after even more nested sessions), stop the session. This will resume previous one: sync text for its current tabstop and show highlighting. The experience of text synchronization only after resuming session is similar to how editing in <a href="https://neovim.io/doc/user/helptag.html?tag=visual-block">visual-block</a> mode works. Nothing else (like cursor/mode/buffer) is changed for a smoother automated session stop.</p></li>
</ul>
<p>Notes about the choice of the “session stack” approach to nesting over more common “merge into single session” approach:</p>
<ul>
<li><p>Does not overload with highlighting.</p></li>
<li><p>Allows nested sessions in different buffers.</p></li>
<li><p>Doesn’t need a complex logic of injecting one session into another.</p></li>
</ul></li>
<li><p>Repeat edit/jump/nest steps any number of times.</p></li>
<li><p>Stop. It can be done in two ways:</p>
<ul>
<li><p>Manually by pressing <span class="help-syntax-keys">&lt;C-c&gt;</span> or calling <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.session.stop">MiniSnippets.session.stop()</a>. Exact key can be adjusted in <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.config">MiniSnippets.config</a> <code>mappings</code>.</p></li>
<li><p>Automatically: any text edit or switching to Normal mode stops session if final tabstop (<code>$0</code>) is current. Its presence is ensured after insert. Not stopping session right away after jumping to final mode (as most other snippet plugins do) allows going back to other tabstops in case of a late missed typo. Wrapping around the edge during jumping also helps with that. If current tabstop is not final, exiting into Normal mode for quick edit outside of snippets range (or carefully inside) is fine. Later get back into Insert mode and jump to next tabstop or manually stop session. See <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-examples">MiniSnippets-examples</a> for how to set up custom stopping rules.</p></li>
</ul></li>
</ul>
<p>Use <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.session.get">MiniSnippets.session.get()</a> to get data about active/nested session(s). Use <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.session.jump">MiniSnippets.session.jump()</a> / <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.session.stop">MiniSnippets.session.stop()</a> in mappings.</p>
<p>What is allowed but not officially supported/recommended:</p>
<ul>
<li>Editing text within snippet range but outside of session life cycle. Mostly behaves as expected, but may harm tracking metadata (<a href="https://neovim.io/doc/user/helptag.html?tag=extmarks">extmarks</a>). In general anything but deleting tabstop range should be OK. Text synchronization of current tabstop would still be active.</li>
</ul>
</section>
<section id="minisnippets.default_insert-events" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.default_insert-events">Events</h4>
<p><a name="minisnippets-events" href="../../mini.nvim/doc/mini-snippets.html#minisnippets-events"><b>MiniSnippets-events</b></a></p>
<p>General session activity (autocommand data contains <span class="help-syntax-keys">&lt;session&gt;</span> field):</p>
<ul>
<li><p><code>MiniSnippetsSessionStart</code> - after a session is started.</p></li>
<li><p><code>MiniSnippetsSessionStop</code> - before a session is stopped.</p></li>
</ul>
<p>Nesting session activity (autocommand data contains <span class="help-syntax-keys">&lt;session&gt;</span> field):</p>
<ul>
<li><p><code>MiniSnippetsSessionSuspend</code> - before a session is suspended.</p></li>
<li><p><code>MiniSnippetsSessionResume</code> - after a session is resumed.</p></li>
</ul>
<p>Jumping between tabstops (autocommand data contains <span class="help-syntax-keys">&lt;tabstop_from&gt;</span> and <span class="help-syntax-keys">&lt;tabstop_new&gt;</span> fields):</p>
<ul>
<li><p><code>MiniSnippetsSessionJumpPre</code> - before jumping to a new tabstop.</p></li>
<li><p><code>MiniSnippetsSessionJump</code> - after jumping to a new tabstop.</p></li>
</ul>
</section>
<section id="minisnippets.default_insert-parameters" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.default_insert-parameters">Parameters</h4>
<p><span class="help-syntax-special">{snippet}</span> <code>(table)</code> Snippet table. Field <span class="help-syntax-keys">&lt;body&gt;</span> is mandatory.</p>
<p><span class="help-syntax-special">{opts}</span> <code>(table|nil)</code> Options. Possible fields:</p>
<ul>
<li><p><span class="help-syntax-keys">&lt;empty_tabstop&gt;</span> <code>(string)</code> - used to visualize empty regular tabstops. Default: “•”.</p></li>
<li><p><span class="help-syntax-keys">&lt;empty_tabstop_final&gt;</span> <code>(string)</code> - used to visualize empty final tabstop(s). Default: “∎”.</p></li>
<li><p><span class="help-syntax-keys">&lt;lookup&gt;</span> <code>(table)</code> - passed to <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.parse">MiniSnippets.parse()</a>. Use it to adjust how variables are evaluated. Default: <code>{}</code>.</p></li>
</ul>
<hr>
</section>
</section>
<section id="minisnippets.session" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="minisnippets.session">session</h3>
<p align="center">
<code>MiniSnippets.session</code>
</p>
<p>Work with snippet session from <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.default_insert">MiniSnippets.default_insert()</a></p>
<hr>
</section>
<section id="minisnippets.session.get" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="minisnippets.session.get">session.get()</h3>
<p align="center">
<code>MiniSnippets.session.get</code>(<span class="help-syntax-special">{all}</span>)
</p>
<p>Get data about active session</p>
<section id="minisnippets.session.get-parameters" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.session.get-parameters">Parameters</h4>
<p><span class="help-syntax-special">{all}</span> <code>(boolean|nil)</code> Whether to return array with the whole session stack. Default: <code>false</code>.</p>
</section>
<section id="minisnippets.session.get-return" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.session.get-return">Return</h4>
<p><code>(table)</code> Single table with session data (if <code>all</code> is <code>false</code>) or array of them. Session data contains the following fields:</p>
<ul>
<li><p><span class="help-syntax-keys">&lt;buf_id&gt;</span> <code>(number)</code> - identifier of session’s buffer.</p></li>
<li><p><span class="help-syntax-keys">&lt;cur_tabstop&gt;</span> <code>(string)</code> - identifier of session’s current tabstop.</p></li>
<li><p><span class="help-syntax-keys">&lt;extmark_id&gt;</span> <code>(number)</code> - <a href="https://neovim.io/doc/user/helptag.html?tag=extmark">extmark</a> identifier which track session range.</p></li>
<li><p><span class="help-syntax-keys">&lt;insert_args&gt;</span> <code>(table)</code> - <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.default_insert">MiniSnippets.default_insert()</a> arguments used to create the session. A table with <span class="help-syntax-keys">&lt;snippet&gt;</span> and <span class="help-syntax-keys">&lt;opts&gt;</span> fields.</p></li>
<li><p><span class="help-syntax-keys">&lt;nodes&gt;</span> <code>(table)</code> - parsed array of snippet nodes which is kept up to date during session. Has the structure of a normalized <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.parse">MiniSnippets.parse()</a> output, plus every node contains <code>extmark_id</code> field with <a href="https://neovim.io/doc/user/helptag.html?tag=extmark">extmark</a> identifier which can be used to get data about the current node state.</p></li>
<li><p><span class="help-syntax-keys">&lt;ns_id&gt;</span> <code>(number)</code> - <a href="https://neovim.io/doc/user/helptag.html?tag=namespace">namespace</a> identifier for all session’s extmarks.</p></li>
<li><p><span class="help-syntax-keys">&lt;tabstops&gt;</span> <code>(table)</code> - data about session’s tabstops. Fields are string tabstop identifiers and values are tables with the following fields:</p>
<ul>
<li><p><span class="help-syntax-keys">&lt;is_visited&gt;</span> <code>(boolean)</code> - whether tabstop was visited.</p></li>
<li><p><span class="help-syntax-keys">&lt;next&gt;</span> <code>(string)</code> - identifier of the next tabstop.</p></li>
<li><p><span class="help-syntax-keys">&lt;prev&gt;</span> <code>(string)</code> - identifier of the previous tabstop.</p></li>
</ul></li>
</ul>
<hr>
</section>
</section>
<section id="minisnippets.session.jump" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="minisnippets.session.jump">session.jump()</h3>
<p align="center">
<code>MiniSnippets.session.jump</code>(<span class="help-syntax-special">{direction}</span>)
</p>
<p>Jump to next/previous tabstop</p>
<p>Make next/previous tabstop be current. Executes the following steps:</p>
<ul>
<li><p>Mark current tabstop as visited.</p></li>
<li><p>Find the next/previous tabstop id assuming they are sorted as numbers. Tabstop “0” is always last. Search is wrapped around the edges: first and final tabstops are next/previous for one another.</p></li>
<li><p>Focus on target tabstop:</p>
<ul>
<li><p>Ensure session’s buffer is current.</p></li>
<li><p>Adjust highlighting of affected nodes.</p></li>
<li><p>Set cursor at tabstop’s reference node (first node among linked). Cursor is placed on left edge if tabstop has not been edited yet (so typing text replaces placeholder), on right edge otherwise (to update already edited text).</p></li>
<li><p>Show all choices for tabstop with choices. Navigating through choices will update tabstop’s text.</p></li>
</ul></li>
</ul>
<section id="minisnippets.session.jump-parameters" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.session.jump-parameters">Parameters</h4>
<p><span class="help-syntax-special">{direction}</span> <code>(string)</code> One of “next” or “prev”.</p>
<hr>
</section>
</section>
<section id="minisnippets.session.stop" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="minisnippets.session.stop">session.stop()</h3>
<p align="center">
<code>MiniSnippets.session.stop</code>()
</p>
<p>Stop (only) active session</p>
<p>To stop all nested sessions use the following code:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">MiniSnippets</span><span class="op">.</span><span class="va">session</span><span class="op">.</span>get<span class="op">()</span> <span class="cf">do</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="va">MiniSnippets</span><span class="op">.</span><span class="va">session</span><span class="op">.</span>stop<span class="op">()</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
<section id="minisnippets.parse" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="minisnippets.parse">parse()</h3>
<p align="center">
<code>MiniSnippets.parse</code>(<span class="help-syntax-special">{snippet_body}</span>, <span class="help-syntax-special">{opts}</span>)
</p>
<p>Parse snippet</p>
<section id="minisnippets.parse-parameters" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.parse-parameters">Parameters</h4>
<p><span class="help-syntax-special">{snippet_body}</span> <code>(string|table)</code> Snippet body as string or array of strings. Should follow <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-syntax-specification">MiniSnippets-syntax-specification</a>.</p>
<p><span class="help-syntax-special">{opts}</span> <code>(table|nil)</code> Options. Possible fields:</p>
<ul>
<li><p><span class="help-syntax-keys">&lt;normalize&gt;</span> <code>(boolean)</code> - whether to normalize nodes:</p>
<ul>
<li><p>Evaluate variable nodes and add output as a <code>text</code> field. If variable is not set, <code>text</code> field is <code>nil</code>. Values from <code>opts.lookup</code> are preferred over evaluation output. See <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets-syntax-specification">MiniSnippets-syntax-specification</a> for more info about variables.</p></li>
<li><p>Add <code>text</code> field for tabstops present in <code>opts.lookup</code>.</p></li>
<li><p>Ensure every node contains exactly one of <code>text</code> or <code>placeholder</code> fields. If there are none, add default <code>placeholder</code> (one text node with first choice or empty string). If there are both, remove <code>placeholder</code> field.</p></li>
<li><p>Ensure present final tabstop: append to end if absent.</p></li>
<li><p>Ensure that nodes for same tabstop have same placeholder. Use the one from the first node. Default: <code>false</code>.</p></li>
</ul></li>
<li><p><span class="help-syntax-keys">&lt;lookup&gt;</span> <code>(table)</code> - map from variable/tabstop (string) name to its value. Default: <code>{}</code>.</p></li>
</ul>
</section>
<section id="minisnippets.parse-return" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.parse-return">Return</h4>
<p><code>(table)</code> Array of nodes. Node is a table with fields depending on node type:</p>
<ul>
<li><p>Text node:</p>
<ul>
<li><span class="help-syntax-keys">&lt;text&gt;</span> <code>(string)</code> - node’s text.</li>
</ul></li>
<li><p>Tabstop node:</p>
<ul>
<li><p><span class="help-syntax-keys">&lt;tabstop&gt;</span> <code>(string)</code> - tabstop identifier.</p></li>
<li><p><span class="help-syntax-keys">&lt;text&gt;</span> <code>(string|nil)</code> - tabstop value (if present in <span class="help-syntax-keys">&lt;lookup&gt;</span>).</p></li>
<li><p><span class="help-syntax-keys">&lt;placeholder&gt;</span> <code>(table|nil)</code> - array of nodes to be used as placeholder.</p></li>
<li><p><span class="help-syntax-keys">&lt;choices&gt;</span> <code>(table|nil)</code> - array of string choices.</p></li>
<li><p><span class="help-syntax-keys">&lt;transform&gt;</span> <code>(table|nil)</code> - array of transformation string parts.</p></li>
</ul></li>
<li><p>Variable node:</p>
<ul>
<li><p><span class="help-syntax-keys">&lt;var&gt;</span> <code>(string)</code> - variable name.</p></li>
<li><p><span class="help-syntax-keys">&lt;text&gt;</span> <code>(string|nil)</code> - variable value.</p></li>
<li><p><span class="help-syntax-keys">&lt;placeholder&gt;</span> <code>(table|nil)</code> - array of nodes to be used as placeholder.</p></li>
<li><p><span class="help-syntax-keys">&lt;transform&gt;</span> <code>(table|nil)</code> - array of transformation string parts.</p></li>
</ul></li>
</ul>
<hr>
</section>
</section>
<section id="minisnippets.start_lsp_server" class="level3 help-syntax-right-anchor">
<h3 class="help-syntax-right-anchor anchored" data-anchor-id="minisnippets.start_lsp_server">start_lsp_server()</h3>
<p align="center">
<code>MiniSnippets.start_lsp_server</code>(<span class="help-syntax-special">{opts}</span>)
</p>
<p>Start completion LSP server</p>
<p>This starts (<a href="https://neovim.io/doc/user/helptag.html?tag=vim.lsp.start()">vim.lsp.start()</a>) an LSP server with the purpose of displaying snippets in (auto)completion engines (<a href="../../mini.nvim/doc/mini-completion.html#mini.completion">mini.completion</a> in particular). The server:</p>
<ul>
<li><p>Only implements <code>textDocument/completion</code> method which prepares and matches snippets at cursor (via <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.expand">MiniSnippets.expand()</a>).</p></li>
<li><p>Auto-attaches to all loaded buffers by default.</p></li>
</ul>
<section id="minisnippets.start_lsp_server-parameters" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.start_lsp_server-parameters">Parameters</h4>
<p><span class="help-syntax-special">{opts}</span> <code>(table|nil)</code> Options. Possible fields:</p>
<ul>
<li><p><span class="help-syntax-keys">&lt;before_attach&gt;</span> <code>(function)</code> - function executed before every attach to the buffer. Takes buffer id as input and can return <code>false</code> (not <code>nil</code>) to cancel attaching to the buffer. Default: attach to loaded normal buffers.</p></li>
<li><p><span class="help-syntax-keys">&lt;match&gt;</span> <code>(false|function)</code> - value of <code>opts.match</code> forwarded to the <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.expand">MiniSnippets.expand()</a> when computing completion candidates. Supply <code>false</code> to not do matching at cursor, return all available snippets in cursor context, and rely on completion engine to match and sort items. Default: <code>nil</code> (equivalent to <a href="../../mini.nvim/doc/mini-snippets.html#minisnippets.default_match">MiniSnippets.default_match()</a>).</p></li>
<li><p><span class="help-syntax-keys">&lt;server_config&gt;</span> <code>(table)</code> - server config to be used as basis for first argument to <a href="https://neovim.io/doc/user/helptag.html?tag=vim.lsp.start()">vim.lsp.start()</a> (<code>cmd</code> will be overridden). Default: <code>{}</code>.</p></li>
<li><p><span class="help-syntax-keys">&lt;triggers&gt;</span> <code>(table)</code> - array of trigger characters to be used as <code>completionProvider.triggerCharacters</code> server capability. Default: <code>{}</code>.</p></li>
</ul>
</section>
<section id="minisnippets.start_lsp_server-return" class="level4">
<h4 class="anchored" data-anchor-id="minisnippets.start_lsp_server-return">Return</h4>
<p><code>(integer|nil)</code> Identifier of started LSP server.</p>


</section>
</section>

</main> <!-- /main -->
<!-- Original source: https://gc.zgo.at/count.js -->
<!-- Inlined for security reasons (less supply chain attack possibility) -->
<script data-goatcounter="https://nvim-mini.goatcounter.com/count">
// GoatCounter: https://www.goatcounter.com
// This file is released under the ISC license: https://opensource.org/licenses/ISC
;(function() {
	'use strict';

	window.goatcounter = window.goatcounter || {}

	// Load settings from data-goatcounter-settings.
	var s = document.querySelector('script[data-goatcounter]')
	if (s && s.dataset.goatcounterSettings) {
		try         { var set = JSON.parse(s.dataset.goatcounterSettings) }
		catch (err) { console.error('invalid JSON in data-goatcounter-settings: ' + err) }
		for (var k in set)
			if (['no_onload', 'no_events', 'allow_local', 'allow_frame', 'path', 'title', 'referrer', 'event'].indexOf(k) > -1)
				window.goatcounter[k] = set[k]
	}

	var enc = encodeURIComponent

	// Get all data we're going to send off to the counter endpoint.
	window.goatcounter.get_data = function(vars) {
		vars = vars || {}
		var data = {
			p: (vars.path     === undefined ? goatcounter.path     : vars.path),
			r: (vars.referrer === undefined ? goatcounter.referrer : vars.referrer),
			t: (vars.title    === undefined ? goatcounter.title    : vars.title),
			e: !!(vars.event || goatcounter.event),
			s: window.screen.width,
			b: is_bot(),
			q: location.search,
		}

		var rcb, pcb, tcb  // Save callbacks to apply later.
		if (typeof(data.r) === 'function') rcb = data.r
		if (typeof(data.t) === 'function') tcb = data.t
		if (typeof(data.p) === 'function') pcb = data.p

		if (is_empty(data.r)) data.r = document.referrer
		if (is_empty(data.t)) data.t = document.title
		if (is_empty(data.p)) data.p = get_path()

		if (rcb) data.r = rcb(data.r)
		if (tcb) data.t = tcb(data.t)
		if (pcb) data.p = pcb(data.p)
		return data
	}

	// Check if a value is "empty" for the purpose of get_data().
	var is_empty = function(v) { return v === null || v === undefined || typeof(v) === 'function' }

	// See if this looks like a bot; there is some additional filtering on the
	// backend, but these properties can't be fetched from there.
	var is_bot = function() {
		// Headless browsers are probably a bot.
		var w = window, d = document
		if (w.callPhantom || w._phantom || w.phantom)
			return 150
		if (w.__nightmare)
			return 151
		if (d.__selenium_unwrapped || d.__webdriver_evaluate || d.__driver_evaluate)
			return 152
		if (navigator.webdriver)
			return 153
		return 0
	}

	// Object to urlencoded string, starting with a ?.
	var urlencode = function(obj) {
		var p = []
		for (var k in obj)
			if (obj[k] !== '' && obj[k] !== null && obj[k] !== undefined && obj[k] !== false)
				p.push(enc(k) + '=' + enc(obj[k]))
		return '?' + p.join('&')
	}

	// Show a warning in the console.
	var warn = function(msg) {
		if (console && 'warn' in console)
			console.warn('goatcounter: ' + msg)
	}

	// Get the endpoint to send requests to.
	var get_endpoint = function() {
		var s = document.querySelector('script[data-goatcounter]')
		return (s && s.dataset.goatcounter) ? s.dataset.goatcounter : goatcounter.endpoint
	}

	// Get current path.
	var get_path = function() {
		var loc = location,
			c = document.querySelector('link[rel="canonical"][href]')
		if (c) {  // May be relative or point to different domain.
			var a = document.createElement('a')
			a.href = c.href
			if (a.hostname.replace(/^www\./, '') === location.hostname.replace(/^www\./, ''))
				loc = a
		}
		return (loc.pathname + loc.search) || '/'
	}

	// Run function after DOM is loaded.
	var on_load = function(f) {
		if (document.body === null)
			document.addEventListener('DOMContentLoaded', function() { f() }, false)
		else
			f()
	}

	// Filter some requests that we (probably) don't want to count.
	window.goatcounter.filter = function() {
		if ('visibilityState' in document && document.visibilityState === 'prerender')
			return 'visibilityState'
		if (!goatcounter.allow_frame && location !== parent.location)
			return 'frame'
		if (!goatcounter.allow_local && location.hostname.match(/(localhost$|^127\.|^10\.|^172\.(1[6-9]|2[0-9]|3[0-1])\.|^192\.168\.|^0\.0\.0\.0$)/))
			return 'localhost'
		if (!goatcounter.allow_local && location.protocol === 'file:')
			return 'localfile'
		if (localStorage && localStorage.getItem('skipgc') === 't')
			return 'disabled with #toggle-goatcounter'
		return false
	}

	// Get URL to send to GoatCounter.
	window.goatcounter.url = function(vars) {
		var data = window.goatcounter.get_data(vars || {})
		if (data.p === null)  // null from user callback.
			return
		data.rnd = Math.random().toString(36).substr(2, 5)  // Browsers don't always listen to Cache-Control.

		var endpoint = get_endpoint()
		if (!endpoint)
			return warn('no endpoint found')

		return endpoint + urlencode(data)
	}

	// Count a hit.
	window.goatcounter.count = function(vars) {
		var f = goatcounter.filter()
		if (f)
			return warn('not counting because of: ' + f)
		var url = goatcounter.url(vars)
		if (!url)
			return warn('not counting because path callback returned null')

		if (!navigator.sendBeacon(url)) {
			// This mostly fails due to being blocked by CSP; try again with an
			// image-based fallback.
			var img = document.createElement('img')
			img.src = url
			img.style.position = 'absolute'  // Affect layout less.
			img.style.bottom = '0px'
			img.style.width = '1px'
			img.style.height = '1px'
			img.loading = 'eager'
			img.setAttribute('alt', '')
			img.setAttribute('aria-hidden', 'true')

			var rm = function() { if (img && img.parentNode) img.parentNode.removeChild(img) }
			img.addEventListener('load', rm, false)
			document.body.appendChild(img)
		}
	}

	// Get a query parameter.
	window.goatcounter.get_query = function(name) {
		var s = location.search.substr(1).split('&')
		for (var i = 0; i < s.length; i++)
			if (s[i].toLowerCase().indexOf(name.toLowerCase() + '=') === 0)
				return s[i].substr(name.length + 1)
	}

	// Track click events.
	window.goatcounter.bind_events = function() {
		if (!document.querySelectorAll)  // Just in case someone uses an ancient browser.
			return

		var send = function(elem) {
			return function() {
				goatcounter.count({
					event:    true,
					path:     (elem.dataset.goatcounterClick || elem.name || elem.id || ''),
					title:    (elem.dataset.goatcounterTitle || elem.title || (elem.innerHTML || '').substr(0, 200) || ''),
					referrer: (elem.dataset.goatcounterReferrer || elem.dataset.goatcounterReferral || ''),
				})
			}
		}

		Array.prototype.slice.call(document.querySelectorAll("*[data-goatcounter-click]")).forEach(function(elem) {
			if (elem.dataset.goatcounterBound)
				return
			var f = send(elem)
			elem.addEventListener('click', f, false)
			elem.addEventListener('auxclick', f, false)  // Middle click.
			elem.dataset.goatcounterBound = 'true'
		})
	}

	// Add a "visitor counter" frame or image.
	window.goatcounter.visit_count = function(opt) {
		on_load(function() {
			opt        = opt        || {}
			opt.type   = opt.type   || 'html'
			opt.append = opt.append || 'body'
			opt.path   = opt.path   || get_path()
			opt.attr   = opt.attr   || {width: '200', height: (opt.no_branding ? '60' : '80')}

			opt.attr['src'] = get_endpoint() + 'er/' + enc(opt.path) + '.' + enc(opt.type) + '?'
			if (opt.no_branding) opt.attr['src'] += '&no_branding=1'
			if (opt.style)       opt.attr['src'] += '&style=' + enc(opt.style)
			if (opt.start)       opt.attr['src'] += '&start=' + enc(opt.start)
			if (opt.end)         opt.attr['src'] += '&end='   + enc(opt.end)

			var tag = {png: 'img', svg: 'img', html: 'iframe'}[opt.type]
			if (!tag)
				return warn('visit_count: unknown type: ' + opt.type)

			if (opt.type === 'html') {
				opt.attr['frameborder'] = '0'
				opt.attr['scrolling']   = 'no'
			}

			var d = document.createElement(tag)
			for (var k in opt.attr)
				d.setAttribute(k, opt.attr[k])

			var p = document.querySelector(opt.append)
			if (!p)
				return warn('visit_count: element to append to not found: ' + opt.append)
			p.appendChild(d)
		})
	}

	// Make it easy to skip your own views.
	if (location.hash === '#toggle-goatcounter') {
		if (localStorage.getItem('skipgc') === 't') {
			localStorage.removeItem('skipgc', 't')
			alert('GoatCounter tracking is now ENABLED in this browser.')
		}
		else {
			localStorage.setItem('skipgc', 't')
			alert('GoatCounter tracking is now DISABLED in this browser until ' + location + ' is loaded again.')
		}
	}

	if (!goatcounter.no_onload)
		on_load(function() {
			// 1. Page is visible, count request.
			// 2. Page is not yet visible; wait until it switches to 'visible' and count.
			// See #487
			if (!('visibilityState' in document) || document.visibilityState === 'visible')
				goatcounter.count()
			else {
				var f = function(e) {
					if (document.visibilityState !== 'visible')
						return
					document.removeEventListener('visibilitychange', f)
					goatcounter.count()
				}
				document.addEventListener('visibilitychange', f)
			}

			if (!goatcounter.no_events)
				goatcounter.bind_events()
		})
})();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/nvim-mini\.org");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>© Evgeni Chasnovski, <a href="https://choosealicense.com/licenses/mit/">MIT</a></p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>